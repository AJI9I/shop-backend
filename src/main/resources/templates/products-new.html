<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru" class="color-two">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title -->
    <title th:text="'Каталог товаров - MinerHive'">Каталог товаров - MinerHive</title>
    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{/assets/images/logo/favicon.png}" href="assets/images/logo/favicon.png">

    <!-- Bootstrap -->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}" href="assets/css/bootstrap.min.css">
    <!-- select 2 -->
    <link rel="stylesheet" th:href="@{/assets/css/select2.min.css}" href="assets/css/select2.min.css">
    <!-- Slick -->
    <link rel="stylesheet" th:href="@{/assets/css/slick.css}" href="assets/css/slick.css">
    <!-- jQuery UI -->
    <link rel="stylesheet" th:href="@{/assets/css/jquery-ui.css}" href="assets/css/jquery-ui.css">
    <!-- Main css -->
    <link rel="stylesheet" th:href="@{/assets/css/main.css}" href="assets/css/main.css">
    <!-- Custom styles для переопределения стилей темы -->
    <style>
        /* Предотвращаем перенос текста в ссылках header-top */
        .header-top ul li a {
            white-space: nowrap !important;
        }
        
        /* Убираем верхний отступ у секции товаров */
        .shop.py-80 {
            padding-top: 0 !important;
        }
        
        /* Стили для контейнера изображения в карточках товаров */
        .product-card__thumb {
            height: 250px !important;
            max-height: 250px !important;
            overflow: hidden !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            background-color: #ffffff !important; /* Белый фон вместо серого */
        }
        
        /* Стили для изображений в карточках товаров */
        .product-card__thumb img {
            max-width: 100% !important;
            max-height: 100% !important;
            width: auto !important;
            height: auto !important;
            object-fit: contain !important;
            display: block !important;
        }
        
        @media screen and (max-width: 1199px) {
            .product-card__thumb {
                height: 220px !important;
                max-height: 220px !important;
            }
        }
        
        /* Стили для grid-контейнера карточек товаров */
        .list-grid-wrapper {
            display: grid !important;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
            gap: 24px !important;
        }
        
        /* Ограничиваем ширину карточек товаров */
        .product-card {
            max-width: 100% !important;
            width: 100% !important;
            background-color: #ffffff !important; /* Белый фон для карточки */
        }
        
        /* Стили для sidebar */
        .shop-sidebar {
            position: relative;
        }
        
        .shop-sidebar__close {
            display: none;
        }
        
        @media screen and (max-width: 991px) {
            .list-grid-wrapper {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)) !important;
                gap: 16px !important;
            }
            
            .shop-sidebar {
                position: fixed;
                top: 0;
                left: -100%;
                width: 300px;
                height: 100vh;
                background: white;
                z-index: 9999;
                padding: 20px;
                overflow-y: auto;
                transition: left 0.3s;
            }
            
            .shop-sidebar.active {
                left: 0;
            }
            
            .shop-sidebar__close {
                display: flex;
            }
        }
        
        @media screen and (max-width: 576px) {
            .list-grid-wrapper {
                grid-template-columns: 1fr !important;
                gap: 16px !important;
            }
        }
    </style>
</head> 
<body>
    
<!--==================== Preloader Start ====================-->
  <div class="preloader">
    <img th:src="@{/assets/images/icon/preloader.gif}" src="assets/images/icon/preloader.gif" alt="">
  </div>
<!--==================== Preloader End ====================-->

<!--==================== Overlay Start ====================-->
<div class="overlay"></div>
<!--==================== Overlay End ====================-->

<!--==================== Sidebar Overlay Start ====================-->
<div class="side-overlay"></div>
<!--==================== Sidebar Overlay End ====================-->

<!-- ==================== Scroll to Top Start ==================== -->
<div class="progress-wrap">
  <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
      <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
  </svg>
</div>
<!-- ==================== Scroll to Top End ==================== -->

<!-- ==================== Search Box Start ==================== -->
 <form th:action="@{/products}" method="get" class="search-box">
  <button type="button" class="search-box__close position-absolute inset-block-start-0 inset-inline-end-0 m-16 w-48 h-48 border border-gray-100 rounded-circle flex-center text-white hover-text-gray-800 hover-bg-white text-2xl transition-1">
    <i class="ph ph-x"></i>
  </button>
  <div class="container">
    <div class="position-relative">
      <input type="text" name="search" class="form-control py-16 px-24 text-xl rounded-pill pe-64" placeholder="Поиск майнеров..." th:value="${search != null ? search : ''}">
      <button type="submit" class="w-48 h-48 bg-main-two-600 rounded-circle flex-center text-xl text-white position-absolute top-50 translate-middle-y inset-inline-end-0 me-8">
        <i class="ph ph-magnifying-glass"></i>
      </button>
    </div>
  </div>
 </form>
<!-- ==================== Search Box End ==================== -->

<!-- ==================== Mobile Menu Start ==================== -->
<div class="mobile-menu scroll-sm d-lg-none d-block">
    <button type="button" class="close-button"> <i class="ph ph-x"></i> </button>
    <div class="mobile-menu__inner">
        <a th:href="@{/}" class="mobile-menu__logo">
            <img th:src="@{/assets/images/logo/logo.png}" src="/assets/images/logo/logo.png" alt="MinerHive Logo">
        </a>
        <div class="mobile-menu__menu">
            <!-- Nav Menu Start -->
<ul class="nav-menu flex-align nav-menu--mobile">
    <li class="nav-menu__item">
        <a th:href="@{/}" class="nav-menu__link">Главная</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/products}" class="nav-menu__link">Товары</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/about}" class="nav-menu__link">О нас</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/delivery}" class="nav-menu__link">Доставка</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/services}" class="nav-menu__link">Услуги</a>
    </li>
</ul>
<!-- Nav Menu End -->
        </div>
    </div>
</div>
<!-- ==================== Mobile Menu End ==================== -->

    <!-- ======================= Header Top Start ========================= -->
<div class="header-top bg-main-two-600 flex-between">
    <div class="container container-lg">
        <div class="flex-between flex-nowrap gap-8">
            <ul class="flex-align flex-nowrap">
                <li class="border-right-item"><a th:href="@{/about}" class="text-white text-sm hover-text-decoration-underline">О нас</a></li>
                <li class="border-right-item"><a th:href="@{/delivery}" class="text-white text-sm hover-text-decoration-underline">Доставка</a></li>
                <li class="border-right-item"><a th:href="@{/services}" class="text-white text-sm hover-text-decoration-underline">Услуги</a></li>
            </ul>
            <ul class="header-top__right flex-align flex-nowrap">
                <li class="border-right-item">
                    <a th:href="@{/products}" class="text-white text-sm py-8 flex-align gap-6"> 
                        <span class="icon text-md d-flex"> <i class="ph ph-box"></i> </span> 
                        <span class="hover-text-decoration-underline">Товары</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- ======================= Header Top End ========================= -->

    <!-- ======================= Middle Header Two Start ========================= -->
<header class="header-middle style-two bg-color-neutral">
    <div class="container container-lg">
        <nav class="header-inner flex-between">
            <!-- Logo Start -->
            <div class="logo">
                <a th:href="@{/}" class="link">
                    <img th:src="@{/assets/images/logo/logo-two.png}" src="/assets/images/logo/logo-two.png" alt="MinerHive Logo">
                </a>
            </div>
            <!-- Logo End  -->

            <!-- form Category Start -->
            <div class="flex-align gap-16">
                <form th:action="@{/products}" method="get" class="flex-align flex-wrap form-location-wrapper" id="headerSearchForm">
                    <div class="search-category style-two d-flex h-48 search-form d-sm-flex d-none">
                        <div class="search-form__wrapper position-relative">
                            <input type="text" name="search" class="search-form__input common-input py-13 ps-16 pe-18 rounded-0 border-0" placeholder="Поиск майнеров..." th:value="${search != null ? search : ''}" id="headerSearchInput">
                        </div>
                        <button type="submit" class="bg-main-two-600 flex-center text-xl text-white flex-shrink-0 w-48 hover-bg-main-two-700 d-lg-flex d-none"><i class="ph ph-magnifying-glass"></i></button>
                    </div>
                </form>
            </div>
            <!-- form Category End -->
             
            <!-- Header Middle Right start -->
            <div class="header-right flex-align d-lg-block d-none">
                <div class="header-two-activities flex-align flex-wrap gap-32">
                    <button type="button" class="flex-align search-icon d-lg-none d-flex gap-4 item-hover-two">
                        <span class="text-2xl text-white d-flex position-relative item-hover__text">
                            <i class="ph ph-magnifying-glass"></i>
                        </span>
                    </button>
                    <a th:href="@{/products}" class="flex-align flex-column gap-8 item-hover-two">
                        <span class="text-2xl text-white d-flex position-relative item-hover__text">
                            <i class="ph ph-box"></i>
                        </span>
                        <span class="text-md text-white item-hover__text d-none d-lg-flex">Товары</span>
                    </a>
                </div>
            </div>
            <!-- Header Middle Right End  -->
        </nav>
    </div>
</header>
<!-- ======================= Middle Header Two End ========================= -->

    <!-- ==================== Header Start ==================== -->
<header class="header bg-white border-bottom border-gray-100">
    <div class="container container-lg">
        <nav class="header-inner d-flex justify-content-between gap-8">
            <!-- Menu Start  -->
            <div class="header-menu d-lg-block d-none flex-grow-1">
                <!-- Nav Menu Start -->
<ul class="nav-menu flex-align">
    <li class="nav-menu__item">
        <a th:href="@{/}" class="nav-menu__link">Главная</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/products}" class="nav-menu__link">Товары</a>
    </li>
</ul>
<!-- Nav Menu End -->
            </div>
        </nav>
    </div>
</header>
<!-- ==================== Header End ==================== -->

    <!-- ========================= Breadcrumb Start =============================== -->
<div class="breadcrumb py-26 bg-main-two-50">
    <div class="container container-lg">
        <div class="breadcrumb-wrapper flex-between flex-wrap gap-16">
            <h6 class="mb-0">Каталог товаров</h6>
            <ul class="flex-align gap-8 flex-wrap">
                <li class="text-sm">
                    <a th:href="@{/}" class="text-gray-900 flex-align gap-8 hover-text-main-two-600">
                        <i class="ph ph-house"></i>
                        Главная
                    </a>
                </li>
                <li class="flex-align">
                    <i class="ph ph-caret-right"></i>
                </li>
                <li class="text-sm text-main-two-600"> Товары </li>
            </ul>
        </div>
    </div>
</div>
<!-- ========================= Breadcrumb End =============================== -->

    <!-- =============================== Shop Section Start ======================================== -->
 <section class="shop py-80">
    <div class="container container-lg">
        <div class="row">
            <!-- Sidebar Start -->
            <div class="col-lg-3">
                <div class="shop-sidebar">
                    <button type="button" class="shop-sidebar__close d-lg-none d-flex w-32 h-32 flex-center border border-gray-100 rounded-circle hover-bg-main-two-600 position-absolute inset-inline-end-0 me-10 mt-8 hover-text-white hover-border-main-two-600">
                        <i class="ph ph-x"></i>
                    </button>
                    <!-- Блок 1: Фильтр по производителям -->
                    <div class="shop-sidebar__box border border-gray-100 rounded-8 p-32 mb-32">
                        <h6 class="text-xl border-bottom border-gray-100 pb-24 mb-24">Производитель</h6>
                        <div class="flex-wrap gap-8" id="manufacturerFilters">
                            <button type="button" 
                                    class="btn manufacturer-filter-btn mb-8"
                                    data-manufacturer=""
                                    th:classappend="${selectedManufacturers == null || selectedManufacturers.isEmpty()} ? 'btn-main-two' : 'btn-outline-main-two'"
                                    style="font-size: 0.875rem; padding: 6px 12px;">
                                Все
                            </button>
                            <button type="button" 
                                    th:each="manufacturer : ${allManufacturers}"
                                    class="btn manufacturer-filter-btn mb-8"
                                    th:data-manufacturer="${manufacturer}"
                                    th:text="${manufacturer}"
                                    th:classappend="${selectedManufacturers != null && selectedManufacturers.contains(manufacturer)} ? 'btn-main-two' : 'btn-outline-main-two'"
                                    style="font-size: 0.875rem; padding: 6px 12px; white-space: nowrap;">
                                Bitmain
                            </button>
                        </div>
                    </div>
                    
                    <!-- Блок 2: Фильтр по сериям/моделям -->
                    <div class="shop-sidebar__box border border-gray-100 rounded-8 p-32 mb-32">
                        <h6 class="text-xl border-bottom border-gray-100 pb-24 mb-24">Серия/Модель</h6>
                        <div class="max-h-540 overflow-y-auto scroll-sm" id="seriesFilters">
                            <div class="form-check mb-12" th:each="seriesItem : ${allSeries}">
                                <input class="form-check-input series-filter-checkbox" 
                                       type="checkbox" 
                                       th:id="'series_' + ${seriesItem}"
                                       th:value="${seriesItem}"
                                       th:checked="${selectedSeries != null && selectedSeries.contains(seriesItem)}"
                                       style="cursor: pointer;">
                                <label class="form-check-label text-sm text-gray-700" 
                                       th:for="'series_' + ${seriesItem}"
                                       th:utext="${seriesItem}"
                                       style="cursor: pointer;">
                                    S19j
                                </label>
                            </div>
                            <div th:if="${allSeries == null || allSeries.isEmpty()}" class="text-sm text-gray-500">
                                Серии не найдены
                            </div>
                        </div>
                    </div>
                    
                    <!-- Кнопка сброса фильтров -->
                    <div class="shop-sidebar__box">
                        <button type="button" 
                                id="resetFiltersBtn"
                                class="btn btn-outline-main-two w-100 py-12 px-24 rounded-8 fw-medium flex-center gap-8 hover-bg-main-two-600 hover-text-white hover-border-main-two-600">
                            <i class="ph ph-arrow-counter-clockwise"></i>
                            Сбросить фильтры
                        </button>
                    </div>
                </div>
            </div>
            <!-- Sidebar End -->

            <!-- Content Start -->
            <div class="col-lg-9">
                <!-- Top Start -->
                <div class="flex-between gap-16 flex-wrap mb-40">
                    <span class="text-gray-900" th:if="${minerDetailsPage != null && minerDetailsPage.totalElements > 0}">
                        <span th:if="${minerDetailsPage.totalElements == 1}">
                            Показан 1 результат
                        </span>
                        <span th:if="${minerDetailsPage.totalElements > 1}">
                            Показано 
                            <span th:text="${minerDetailsPage.number * minerDetailsPage.size + 1}">1</span>-<span th:text="${minerDetailsPage.number * minerDetailsPage.size + minerDetailsPage.numberOfElements}">12</span> 
                            из <span th:text="${minerDetailsPage.totalElements}">100</span> результатов
                        </span>
                    </span>
                    <span class="text-gray-900" th:if="${minerDetailsPage == null || minerDetailsPage.totalElements == 0}">
                        Товаров не найдено
                    </span>
                    <div class="position-relative flex-align gap-16 flex-wrap">
                        <!-- Сортировка -->
                        <div class="flex-align gap-8">
                            <label for="sortSelect" class="text-sm text-gray-600 mb-0">Сортировка:</label>
                            <select id="sortSelect" class="form-select form-select-sm" style="width: auto; min-width: 220px;">
                                <option value="latestOffer" 
                                        th:selected="${currentSortBy == 'latestOffer' or currentSortBy == null}"
                                        th:text="'По последнему обновлению'">По последнему обновлению</option>
                                <option value="name" 
                                        th:selected="${currentSortBy == 'name'}"
                                        th:text="'По алфавиту'">По алфавиту</option>
                                <option value="manufacturer" 
                                        th:selected="${currentSortBy == 'manufacturer'}"
                                        th:text="'По производителю'">По производителю</option>
                            </select>
                        </div>
                        <!-- Кнопка сброса фильтров (в верхней части для мобильных) -->
                        <button type="button" 
                                id="resetFiltersBtnTop"
                                class="btn btn-outline-main-two py-8 px-16 rounded-8 fw-medium flex-center gap-6 hover-bg-main-two-600 hover-text-white hover-border-main-two-600 d-lg-none d-flex"
                                style="font-size: 0.875rem;">
                            <i class="ph ph-arrow-counter-clockwise"></i>
                            Сбросить
                        </button>
                        <div class="list-grid-btns flex-align gap-16">
                            <button type="button" class="w-44 h-44 flex-center border border-gray-100 rounded-6 text-2xl grid-btn" style="background: var(--main-two-600); color: white;">
                                <i class="ph ph-squares-four"></i>
                            </button>
                        </div>
                        <button type="button" class="w-44 h-44 d-lg-none d-flex flex-center border border-gray-100 rounded-6 text-2xl sidebar-btn"><i class="ph-bold ph-funnel"></i></button>
                    </div>
                </div>
                <!-- Top End -->

                <!-- Пустое состояние -->
                <div th:if="${minerDetailsPage.totalElements == 0}" class="text-center py-80">
                    <div class="w-120 h-120 bg-gray-100 rounded-circle flex-center mx-auto mb-24" style="width: 120px; height: 120px;">
                        <i class="ph ph-box text-gray-400" style="font-size: 3rem;"></i>
                    </div>
                    <h5 class="text-gray-600 mb-8">Майнеров пока нет</h5>
                    <p class="text-gray-500">Майнеры появятся автоматически после обработки сообщений из WhatsApp</p>
                    <a th:href="@{/}" class="btn btn-main-two-600 mt-24">
                        <i class="ph ph-arrow-left"></i> Вернуться на главную
                    </a>
                </div>

                <!-- Grid майнеров -->
                <div class="list-grid-wrapper" th:if="${minerDetailsPage.totalElements > 0}">
                    <div class="product-card h-100 p-16 border border-gray-100 hover-border-main-two-600 rounded-16 position-relative transition-2" 
                         th:each="minerDetail : ${minerDetails}" 
                         th:with="minerInfo=${minerDetailOperationInfo != null ? minerDetailOperationInfo.get(minerDetail.id) : null}, imageUrl=${imageUrls != null ? imageUrls.get(minerDetail.id) : null}">
                        <a th:href="@{'/products/' + ${minerDetail.id}}" class="product-card__thumb flex-center rounded-8 bg-white position-relative" style="background-color: #ffffff !important;">
                            <img th:if="${imageUrl != null && !#strings.isEmpty(imageUrl)}" 
                                 th:src="@{${imageUrl}}" 
                                 th:alt="${minerDetail.standardName}"
                                 alt="Майнер"
                                 onerror="this.onerror=null; this.src='/assets/images/thumbs/product-img1.png';">
                            <img th:unless="${imageUrl != null && !#strings.isEmpty(imageUrl)}" 
                                 th:src="@{/assets/images/thumbs/product-img1.png}" 
                                 src="/assets/images/thumbs/product-img1.png" 
                                 th:alt="${minerDetail.standardName}"
                                 alt="Майнер">
                        </a>
                        <div class="product-card__content mt-16">
                            <h6 class="title text-lg fw-semibold mt-12 mb-8">
                                <a th:href="@{'/products/' + ${minerDetail.id}}" class="link text-line-2" tabindex="0" th:utext="${minerDetail.standardName}">
                                    Название майнера
                                </a>
                            </h6>
                            <div class="flex-align mb-20 mt-16 gap-6">
                                <span class="text-xs fw-medium text-gray-500" 
                                      th:if="${minerInfo != null}"
                                      th:text="'Предложений: ' + (${minerInfo.sellCount} + ${minerInfo.buyCount})">0</span>
                                <span class="text-xs fw-medium text-gray-500" th:if="${minerInfo == null}">Предложений: 0</span>
                                <span class="text-xs fw-medium text-gray-500" th:if="${minerDetail.manufacturer != null}" th:utext="${' • ' + minerDetail.manufacturer}">Производитель</span>
                            </div>
                            <div class="product-card__price my-20">
                                <span class="text-heading text-md fw-semibold" 
                                      th:if="${minerInfo != null && minerInfo.minPrice != null && minerInfo.minPrice.doubleValue() > 0}"
                                      th:text="'от ' + ${#numbers.formatDecimal(minerInfo.minPrice, 0, 'COMMA', 0, 'POINT')} + ' ' + (${minerInfo.currency != null ? minerInfo.currency : 'RUB'})">
                                    от 0 RUB
                                </span>
                                <span class="text-gray-400 text-md" th:if="${minerInfo == null || minerInfo.minPrice == null || (minerInfo.minPrice != null && minerInfo.minPrice.doubleValue() <= 0)}">
                                    Цена не указана
                                </span>
                            </div>
                            <a th:href="@{'/products/' + ${minerDetail.id}}" class="product-card__cart btn bg-gray-50 text-heading hover-bg-main-two-600 hover-text-white py-11 px-24 rounded-8 flex-center gap-8 fw-medium" tabindex="0">
                                Подробнее <i class="ph ph-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <!-- Grid End -->

                <!-- Pagination Start (скрыта, используется бесконечная прокрутка) -->
                <ul class="pagination flex-center flex-wrap gap-16 mt-40" style="display: none;" th:if="${minerDetailsPage.totalPages > 1}">
                    <li class="page-item" th:classappend="${minerDetailsPage.first} ? 'disabled'">
                        <a class="page-link h-64 w-64 flex-center text-xxl rounded-8 fw-medium text-neutral-600 border border-gray-100 hover-bg-main-two-600 hover-text-white hover-border-main-two-600 pagination-link" 
                           th:attr="data-page=${minerDetailsPage.number - 1}"
                           th:if="${!minerDetailsPage.first}">
                            <i class="ph-bold ph-arrow-left"></i>
                        </a>
                        <span class="page-link h-64 w-64 flex-center text-xxl rounded-8 fw-medium text-neutral-400 border border-gray-100" th:if="${minerDetailsPage.first}">
                            <i class="ph-bold ph-arrow-left"></i>
                        </span>
                    </li>
                    <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, minerDetailsPage.totalPages - 1)}"
                        th:classappend="${pageNum == minerDetailsPage.number} ? 'active'">
                        <a class="page-link h-64 w-64 flex-center text-md rounded-8 fw-medium border border-gray-100 hover-bg-main-two-600 hover-text-white hover-border-main-two-600 pagination-link"
                           th:class="${pageNum == minerDetailsPage.number} ? 'bg-main-two-600 text-white border-main-two-600' : 'text-neutral-600'"
                           th:attr="data-page=${pageNum}"
                           th:text="${pageNum + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${minerDetailsPage.last} ? 'disabled'">
                        <a class="page-link h-64 w-64 flex-center text-xxl rounded-8 fw-medium text-neutral-600 border border-gray-100 hover-bg-main-two-600 hover-text-white hover-border-main-two-600 pagination-link"
                           th:attr="data-page=${minerDetailsPage.number + 1}"
                           th:if="${!minerDetailsPage.last}">
                            <i class="ph-bold ph-arrow-right"></i>
                        </a>
                        <span class="page-link h-64 w-64 flex-center text-xxl rounded-8 fw-medium text-neutral-400 border border-gray-100" th:if="${minerDetailsPage.last}">
                            <i class="ph-bold ph-arrow-right"></i>
                        </span>
                    </li>
                </ul>
                <!-- Pagination End -->
                
                <!-- Индикатор загрузки для бесконечной прокрутки -->
                <div id="infiniteScrollLoader" class="text-center py-40" style="display: none;">
                    <div class="spinner-border text-main-two-600" role="status">
                        <span class="visually-hidden">Загрузка...</span>
                    </div>
                    <p class="text-gray-600 mt-16">Загрузка товаров...</p>
                </div>
                
                <!-- Триггер для бесконечной прокрутки -->
                <div id="infiniteScrollTrigger" style="height: 1px; visibility: hidden;"></div>
            </div>
            <!-- Content End -->
        </div>
    </div>
 </section>
<!-- =============================== Shop Section End ======================================== -->

<!-- ==================== Footer Start ==================== -->
<footer class="footer bg-color-one pt-80 pb-40">
    <div class="container container-lg">
        <div class="footer__inner">
            <div class="row gy-4">
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <div class="footer__logo mb-24">
                            <a th:href="@{/}">
                                <img th:src="@{/assets/images/logo/logo.png}" src="/assets/images/logo/logo.png" alt="MinerHive Logo">
                            </a>
                        </div>
                        <p class="text-gray-600">MinerHive - агрегатор предложений по майнинг-оборудованию. Помогаем найти выгодные предложения на рынке.</p>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <h6 class="footer__title mb-24">Быстрые ссылки</h6>
                        <ul class="footer__list">
                            <li><a th:href="@{/}" class="text-gray-600 hover-text-main-two-600">Главная</a></li>
                            <li><a th:href="@{/products}" class="text-gray-600 hover-text-main-two-600">Товары</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <h6 class="footer__title mb-24">Информация</h6>
                        <ul class="footer__list">
                            <li><a th:href="@{/about}" class="text-gray-600 hover-text-main-two-600">О нас</a></li>
                            <li><a th:href="@{/delivery}" class="text-gray-600 hover-text-main-two-600">Доставка</a></li>
                            <li><a th:href="@{/services}" class="text-gray-600 hover-text-main-two-600">Услуги</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <h6 class="footer__title mb-24">Юридическая информация</h6>
                        <ul class="footer__list">
                            <li><a th:href="@{/privacy-policy}" class="text-gray-600 hover-text-main-two-600">Политика конфиденциальности</a></li>
                            <li><a th:href="@{/cookies-policy}" class="text-gray-600 hover-text-main-two-600">Политика cookies</a></li>
                            <li><a th:href="@{/offer}" class="text-gray-600 hover-text-main-two-600">Публичная оферта</a></li>
                            <li><a th:href="@{/user-agreement}" class="text-gray-600 hover-text-main-two-600">Пользовательское соглашение</a></li>
                            <li><a th:href="@{/personal-data-consent}" class="text-gray-600 hover-text-main-two-600">Согласие на обработку данных</a></li>
                            <li><a th:href="@{/company-details}" class="text-gray-600 hover-text-main-two-600">Реквизиты компании</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <h6 class="footer__title mb-24">Контакты</h6>
                        <ul class="footer__list">
                            <li class="text-gray-600">Email: ya@nismeria.com</li>
                            <li class="text-gray-600">Сайт: <a href="https://minerhive.ru" class="text-gray-600 hover-text-main-two-600" target="_blank">minerhive.ru</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- bottom Footer -->
<div class="bottom-footer bg-color-one py-8">
    <div class="container container-lg">
        <div class="bottom-footer__inner flex-between flex-wrap gap-16 py-16">
            <p class="bottom-footer__text">MinerHive &copy; 2025. Все права защищены</p>
        </div>
    </div>
</div>
<!-- ==================== Footer End ==================== -->
  

    
    <!-- jQuery js -->
    <script th:src="@{/assets/js/jquery-3.7.1.min.js}" src="assets/js/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap Bundle Js -->
    <script th:src="@{/assets/js/boostrap.bundle.min.js}" src="assets/js/boostrap.bundle.min.js"></script>
    <!-- Phosphor Icons -->
    <script th:src="@{/assets/js/phosphor-icon.js}" src="assets/js/phosphor-icon.js"></script>
    <!-- Select 2 -->
    <script th:src="@{/assets/js/select2.min.js}" src="assets/js/select2.min.js"></script>
    <!-- Slick js -->
    <script th:src="@{/assets/js/slick.min.js}" src="assets/js/slick.min.js"></script>
    <!-- jQuery UI -->
    <script th:src="@{/assets/js/jquery-ui.js}" src="assets/js/jquery-ui.js"></script>
    <!-- Main js -->
    <script th:src="@{/assets/js/main.js}" src="assets/js/main.js"></script>
    
    <!-- Sidebar toggle для мобильных и обработка сортировки -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarBtn = document.querySelector('.sidebar-btn');
            const sidebar = document.querySelector('.shop-sidebar');
            const sidebarClose = document.querySelector('.shop-sidebar__close');
            const overlay = document.querySelector('.overlay');
            
            if (sidebarBtn && sidebar) {
                sidebarBtn.addEventListener('click', function() {
                    sidebar.classList.add('active');
                    if (overlay) overlay.classList.add('active');
                });
            }
            
            if (sidebarClose && sidebar) {
                sidebarClose.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                    if (overlay) overlay.classList.remove('active');
                });
            }
            
            if (overlay) {
                overlay.addEventListener('click', function() {
                    if (sidebar) sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                });
            }
            
            // Получаем маппинг серий к производителям из шаблона
            const seriesToManufacturersRaw = /*[[${seriesToManufacturersJson}]]*/ '{}';
            // Парсим JSON, если это строка
            const seriesToManufacturers = typeof seriesToManufacturersRaw === 'string' 
                ? JSON.parse(seriesToManufacturersRaw) 
                : seriesToManufacturersRaw;
            
            // Функция фильтрации чекбоксов серий на основе выбранных производителей
            function filterSeriesByManufacturers() {
                const selectedManufacturers = Array.from(document.querySelectorAll('.manufacturer-filter-btn.btn-main-two'))
                    .map(btn => btn.getAttribute('data-manufacturer'))
                    .filter(manufacturer => manufacturer !== '' && manufacturer !== null);
                
                document.querySelectorAll('.series-filter-checkbox').forEach(checkbox => {
                    const seriesValue = checkbox.value;
                    const manufacturersForSeries = seriesToManufacturers[seriesValue] || [];
                    
                    if (selectedManufacturers.length === 0) {
                        // Если производители не выбраны, показываем все серии
                        checkbox.closest('.form-check').style.display = '';
                    } else {
                        // Проверяем, есть ли пересечение между выбранными производителями и производителями серии
                        const hasIntersection = manufacturersForSeries.some(manufacturer => 
                            selectedManufacturers.includes(manufacturer)
                        );
                        checkbox.closest('.form-check').style.display = hasIntersection ? '' : 'none';
                    }
                });
            }
            
            // Обработка выбора сортировки
            const sortSelect = document.getElementById('sortSelect');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    applyFilters();
                });
            }
            
            // Обработка фильтров по производителям
            document.querySelectorAll('.manufacturer-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const manufacturer = this.getAttribute('data-manufacturer');
                    
                    // Если нажали "Все", снимаем все фильтры производителей
                    if (manufacturer === '' || manufacturer === null) {
                        document.querySelectorAll('.manufacturer-filter-btn').forEach(b => {
                            b.classList.remove('btn-main-two');
                            b.classList.add('btn-outline-main-two');
                        });
                        this.classList.remove('btn-outline-main-two');
                        this.classList.add('btn-main-two');
                    } else {
                        if (this.classList.contains('btn-main-two')) {
                            this.classList.remove('btn-main-two');
                            this.classList.add('btn-outline-main-two');
                        } else {
                            this.classList.remove('btn-outline-main-two');
                            this.classList.add('btn-main-two');
                            const allBtn = document.querySelector('.manufacturer-filter-btn[data-manufacturer=""]');
                            if (allBtn) {
                                allBtn.classList.remove('btn-main-two');
                                allBtn.classList.add('btn-outline-main-two');
                            }
                        }
                    }
                    
                    // Фильтруем серии на основе выбранных производителей
                    filterSeriesByManufacturers();
                    
                    applyFilters();
                });
            });
            
            // Обработка фильтров по сериям/моделям (чекбоксы)
            document.querySelectorAll('.series-filter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    applyFilters();
                });
            });
            
            // Переменные для бесконечной прокрутки
            let currentPage = 0;
            let isLoading = false;
            let hasMorePages = true;
            let totalLoaded = 0;
            let totalElements = 0;
            
            // Функция для создания HTML карточки товара
            function createProductCardHTML(minerDetail, imageUrls, operationInfo) {
                const imageUrl = imageUrls[minerDetail.id] || '/assets/images/thumbs/product-img1.png';
                const info = operationInfo[minerDetail.id.toString()] || {};
                const totalOffers = (info.sellCount || 0) + (info.buyCount || 0);
                // Более надежная проверка цены: проверяем, что minPrice существует, не null, не undefined, не 0 и не "0"
                let minPrice = info.minPrice;
                if (minPrice === null || minPrice === undefined || minPrice === 0 || minPrice === "0" || (typeof minPrice === 'number' && minPrice <= 0)) {
                    minPrice = null;
                }
                const currency = info.currency || 'RUB';
                const standardName = (minerDetail.standardName || 'Название майнера').replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                const manufacturer = minerDetail.manufacturer ? (minerDetail.manufacturer.replace(/'/g, "\\'").replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;')) : '';
                
                let html = '<div class="product-card h-100 p-16 border border-gray-100 hover-border-main-two-600 rounded-16 position-relative transition-2">';
                html += '<a href="/products/' + minerDetail.id + '" class="product-card__thumb flex-center rounded-8 bg-white position-relative" style="background-color: #ffffff !important;">';
                html += '<img src="' + imageUrl + '" alt="' + standardName + '" onerror="this.onerror=null; this.src=\'/assets/images/thumbs/product-img1.png\';">';
                html += '</a>';
                html += '<div class="product-card__content mt-16">';
                html += '<h6 class="title text-lg fw-semibold mt-12 mb-8">';
                html += '<a href="/products/' + minerDetail.id + '" class="link text-line-2">' + standardName + '</a>';
                html += '</h6>';
                html += '<div class="flex-align mb-20 mt-16 gap-6">';
                html += '<span class="text-xs fw-medium text-gray-500">Предложений: ' + totalOffers + '</span>';
                if (manufacturer) {
                    html += '<span class="text-xs fw-medium text-gray-500"> • ' + manufacturer + '</span>';
                }
                html += '</div>';
                html += '<div class="product-card__price my-20">';
                // Проверяем, что minPrice не null и больше 0
                if (minPrice != null && minPrice !== 0 && minPrice !== "0" && (typeof minPrice === 'number' ? minPrice > 0 : parseFloat(minPrice) > 0)) {
                    const priceValue = typeof minPrice === 'number' ? minPrice : parseFloat(minPrice);
                    html += '<span class="text-heading text-md fw-semibold">от ' + priceValue.toLocaleString('ru-RU') + ' ' + currency + '</span>';
                } else {
                    html += '<span class="text-gray-400 text-md">Цена не указана</span>';
                }
                html += '</div>';
                html += '<a href="/products/' + minerDetail.id + '" class="product-card__cart btn bg-gray-50 text-heading hover-bg-main-two-600 hover-text-white py-11 px-24 rounded-8 flex-center gap-8 fw-medium">';
                html += 'Подробнее <i class="ph ph-arrow-right"></i>';
                html += '</a>';
                html += '</div>';
                html += '</div>';
                
                return html;
            }
            
            // Функция загрузки товаров через AJAX (с поддержкой бесконечной прокрутки)
            function loadProducts(page = 0, append = false) {
                if (isLoading || (!append && hasMorePages === false && page > 0)) {
                    return;
                }
                
                isLoading = true;
                
                const sortSelect = document.getElementById('sortSelect');
                const sortBy = sortSelect ? sortSelect.value : 'latestOffer';
                
                const selectedManufacturers = Array.from(document.querySelectorAll('.manufacturer-filter-btn.btn-main-two'))
                    .map(btn => btn.getAttribute('data-manufacturer'))
                    .filter(manufacturer => manufacturer !== '' && manufacturer !== null);
                
                const selectedSeries = Array.from(document.querySelectorAll('.series-filter-checkbox:checked'))
                    .map(checkbox => checkbox.value);
                
                // Для первой страницы загружаем 12 товаров, для остальных - 6
                const size = page === 0 ? 12 : 6;
                
                const params = new URLSearchParams();
                params.append('page', page);
                params.append('size', size);
                params.append('sortBy', sortBy);
                selectedManufacturers.forEach(manufacturer => params.append('manufacturer', manufacturer));
                selectedSeries.forEach(series => params.append('series', series));
                
                const productsContainer = document.querySelector('.list-grid-wrapper');
                const emptyState = document.querySelector('.col-lg-9 .text-center.py-80');
                const resultsCounter = document.querySelector('.flex-between.gap-16.flex-wrap.mb-40 > span');
                const loader = document.getElementById('infiniteScrollLoader');
                
                // Показываем индикатор загрузки
                if (append && loader) {
                    loader.style.display = 'block';
                } else if (productsContainer) {
                    productsContainer.style.opacity = '0.5';
                }
                
                fetch('/api/products?' + params.toString())
                    .then(response => {
                        // Проверяем статус ответа
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        // Проверяем Content-Type заголовок
                        const contentType = response.headers.get('content-type');
                        if (!contentType || !contentType.includes('application/json')) {
                            return response.text().then(text => {
                                console.error('Ожидался JSON, но получен:', contentType || 'неизвестный тип');
                                console.error('Первые 500 символов ответа:', text.substring(0, 500));
                                throw new Error('Сервер вернул не JSON. Возможно, произошла ошибка на сервере.');
                            });
                        }
                        
                        return response.json();
                    })
                    .then(data => {
                        isLoading = false;
                        
                        if (data.error) {
                            console.error('Ошибка загрузки товаров:', data.error);
                            if (loader) loader.style.display = 'none';
                            if (productsContainer) productsContainer.style.opacity = '1';
                            return;
                        }
                        
                        totalElements = data.totalElements || 0;
                        hasMorePages = !data.last && data.currentPage < data.totalPages - 1;
                        
                        // Обновляем счетчик результатов
                        if (resultsCounter) {
                            if (append) {
                                // Добавляем количество новых товаров к уже загруженным
                                totalLoaded += (data.content ? data.content.length : 0);
                            } else {
                                // Сбрасываем счетчик при первой загрузке или сбросе фильтров
                                totalLoaded = (data.content ? data.content.length : 0);
                            }
                            
                            if (totalElements === 0) {
                                resultsCounter.innerHTML = '<span class="text-gray-900">Товаров не найдено</span>';
                            } else {
                                const end = Math.min(totalLoaded, totalElements);
                                const start = append ? (totalLoaded - (data.content ? data.content.length : 0) + 1) : 1;
                                
                                if (totalElements === 1) {
                                    resultsCounter.innerHTML = '<span class="text-gray-900">Показан 1 результат</span>';
                                } else {
                                    resultsCounter.innerHTML = `<span class="text-gray-900">Показано ${start}-${end} из ${totalElements} результатов</span>`;
                                }
                            }
                        }
                        
                        // Обновляем контейнер товаров
                        if (productsContainer) {
                            const imageUrls = data.imageUrls || {};
                            const operationInfo = data.operationInfo || {};
                            
                            if (data.content && data.content.length > 0) {
                                const html = data.content.map(minerDetail => createProductCardHTML(minerDetail, imageUrls, operationInfo)).join('');
                                
                                if (append) {
                                    // Добавляем товары к существующим
                                    productsContainer.insertAdjacentHTML('beforeend', html);
                                } else {
                                    // Заменяем все товары (первая загрузка или сброс фильтров)
                                    productsContainer.innerHTML = html;
                                    totalLoaded = data.content.length;
                                }
                                
                                // Обновляем пустое состояние
                                if (emptyState) {
                                    emptyState.style.display = 'none';
                                }
                            } else {
                                if (!append) {
                                    productsContainer.innerHTML = '';
                                    if (emptyState) {
                                        emptyState.style.display = 'block';
                                    }
                                }
                            }
                            
                            productsContainer.style.opacity = '1';
                        }
                        
                        // Скрываем индикатор загрузки
                        if (loader) {
                            loader.style.display = 'none';
                        }
                        
                        // Обновляем текущую страницу
                        currentPage = data.currentPage;
                        
                        // Обновляем триггер и переинициализируем observer
                        const trigger = document.getElementById('infiniteScrollTrigger');
                        if (trigger) {
                            if (hasMorePages) {
                                trigger.style.display = 'block';
                                trigger.style.visibility = 'hidden';
                                trigger.style.height = '1px';
                                // Переинициализируем observer после обновления контента
                                setTimeout(() => {
                                    setupInfiniteScroll();
                                }, 100);
                            } else {
                                trigger.style.display = 'none';
                                // Отключаем observer, если больше нет страниц
                                if (scrollObserver) {
                                    scrollObserver.unobserve(trigger);
                                }
                            }
                        }
                        
                        // Обновляем URL без перезагрузки страницы
                        const newUrl = new URL(window.location.href);
                        if (!append) {
                            newUrl.searchParams.set('page', 0);
                        }
                        newUrl.searchParams.set('sortBy', sortBy);
                        newUrl.searchParams.delete('manufacturer');
                        newUrl.searchParams.delete('series');
                        selectedManufacturers.forEach(manufacturer => newUrl.searchParams.append('manufacturer', manufacturer));
                        selectedSeries.forEach(series => newUrl.searchParams.append('series', series));
                        window.history.pushState({}, '', newUrl);
                    })
                    .catch(error => {
                        isLoading = false;
                        console.error('Ошибка AJAX запроса:', error);
                        console.error('Сообщение об ошибке:', error.message);
                        console.error('Стек ошибки:', error.stack);
                        
                        // Показываем сообщение пользователю в контейнере товаров
                        if (productsContainer) {
                            const errorMessage = error.message || 'Произошла ошибка при загрузке товаров. Пожалуйста, обновите страницу.';
                            productsContainer.innerHTML = `
                                <div class="col-12">
                                    <div class="alert alert-danger" role="alert">
                                        <h5>Ошибка загрузки</h5>
                                        <p>${errorMessage}</p>
                                        <button class="btn btn-primary" onclick="location.reload()">Обновить страницу</button>
                                    </div>
                                </div>
                            `;
                            productsContainer.style.opacity = '1';
                        }
                        
                        if (loader) loader.style.display = 'none';
                    });
            }
            
            // Функция применения фильтров
            function applyFilters() {
                // Сбрасываем состояние бесконечной прокрутки
                currentPage = 0;
                isLoading = false;
                hasMorePages = true;
                totalLoaded = 0;
                totalElements = 0;
                
                // Загружаем первую страницу (12 товаров)
                loadProducts(0, false);
            }
            
            // Функция сброса всех фильтров
            function resetFilters() {
                // Сбрасываем производителей - оставляем только "Все"
                document.querySelectorAll('.manufacturer-filter-btn').forEach(btn => {
                    btn.classList.remove('btn-main-two');
                    btn.classList.add('btn-outline-main-two');
                });
                const allManufacturerBtn = document.querySelector('.manufacturer-filter-btn[data-manufacturer=""]');
                if (allManufacturerBtn) {
                    allManufacturerBtn.classList.remove('btn-outline-main-two');
                    allManufacturerBtn.classList.add('btn-main-two');
                }
                
                // Сбрасываем серии - снимаем все чекбоксы
                document.querySelectorAll('.series-filter-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Сбрасываем сортировку на значение по умолчанию
                const sortSelect = document.getElementById('sortSelect');
                if (sortSelect) {
                    sortSelect.value = 'latestOffer';
                }
                
                // Показываем все серии (так как фильтр производителей сброшен)
                filterSeriesByManufacturers();
                
                // Сбрасываем состояние бесконечной прокрутки
                currentPage = 0;
                isLoading = false;
                hasMorePages = true;
                totalLoaded = 0;
                totalElements = 0;
                
                // Загружаем товары без фильтров
                loadProducts(0, false);
            }
            
            // Глобальная переменная для хранения observer
            let scrollObserver = null;
            
            // Настройка Intersection Observer для бесконечной прокрутки
            function setupInfiniteScroll() {
                // Отключаем предыдущий observer, если он существует
                if (scrollObserver) {
                    const oldTrigger = document.getElementById('infiniteScrollTrigger');
                    if (oldTrigger) {
                        scrollObserver.unobserve(oldTrigger);
                    }
                }
                
                const trigger = document.getElementById('infiniteScrollTrigger');
                if (!trigger) {
                    console.warn('infiniteScrollTrigger не найден');
                    return;
                }
                
                scrollObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && hasMorePages && !isLoading) {
                            console.log('Триггер виден, загружаем следующую страницу. Текущая страница:', currentPage);
                            // Загружаем следующую страницу (6 товаров)
                            loadProducts(currentPage + 1, true);
                        }
                    });
                }, {
                    root: null,
                    rootMargin: '100px', // Начинаем загрузку за 100px до появления триггера
                    threshold: 0.1
                });
                
                scrollObserver.observe(trigger);
                console.log('IntersectionObserver настроен для бесконечной прокрутки');
            }
            
            // Обработчик кнопки сброса фильтров (в сайдбаре)
            const resetFiltersBtn = document.getElementById('resetFiltersBtn');
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    resetFilters();
                });
            }
            
            // Обработчик кнопки сброса фильтров (в верхней части для мобильных)
            const resetFiltersBtnTop = document.getElementById('resetFiltersBtnTop');
            if (resetFiltersBtnTop) {
                resetFiltersBtnTop.addEventListener('click', function(e) {
                    e.preventDefault();
                    resetFilters();
                });
            }
            
            // Инициализация фильтрации серий при загрузке страницы
            filterSeriesByManufacturers();
            
            // Настройка бесконечной прокрутки
            setupInfiniteScroll();
            
            // Проверяем, есть ли параметры фильтров в URL, если да - загружаем товары через AJAX
            const urlParams = new URLSearchParams(window.location.search);
            const hasFilters = urlParams.has('manufacturer') || urlParams.has('series') || 
                               (urlParams.has('sortBy') && urlParams.get('sortBy') !== 'latestOffer');
            
            // Если есть фильтры в URL или пользователь изменил сортировку, загружаем через AJAX
            // В противном случае оставляем серверную отрисовку, но все равно настраиваем бесконечную прокрутку
            if (hasFilters) {
                currentPage = 0;
                totalLoaded = 0;
                totalElements = 0;
                loadProducts(0, false);
            } else {
                // Если нет фильтров, проверяем, есть ли товары на странице (серверная отрисовка)
                const productsContainer = document.querySelector('.list-grid-wrapper');
                if (productsContainer && productsContainer.children.length > 0) {
                    // Подсчитываем уже загруженные товары с сервера
                    totalLoaded = productsContainer.children.length;
                    // Проверяем, есть ли еще страницы (смотрим на пагинацию)
                    const pagination = document.querySelector('.pagination');
                    if (pagination && pagination.children.length > 0) {
                        // Если есть пагинация, значит есть еще страницы
                        hasMorePages = true;
                        // Предполагаем, что мы на странице 0 (первая загрузка была с сервера)
                        currentPage = 0;
                        // Получаем общее количество элементов из счетчика результатов или из пагинации
                        const resultsCounter = document.querySelector('.flex-between.gap-16.flex-wrap.mb-40 > span');
                        if (resultsCounter) {
                            const counterText = resultsCounter.textContent || '';
                            const totalMatch = counterText.match(/из (\d+) результатов/);
                            if (totalMatch) {
                                totalElements = parseInt(totalMatch[1]) || 0;
                            }
                        }
                    } else {
                        // Если нет пагинации, значит больше нет страниц
                        hasMorePages = false;
                        totalElements = totalLoaded;
                    }
                } else {
                    // Если нет товаров на странице, загружаем через AJAX
                    currentPage = 0;
                    totalLoaded = 0;
                    totalElements = 0;
                    loadProducts(0, false);
                }
            }
        });
        /*]]>*/
    </script>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105468809', 'ym');

        ym(105468809, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/105468809" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    </body>
</html>


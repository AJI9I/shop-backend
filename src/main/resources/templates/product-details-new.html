<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru" class="color-two">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title -->
    <title th:text="${minerDetail != null && minerDetail.standardName != null ? 'Майнер ' + minerDetail.standardName + ' - MinerHive' : 'Майнер ' + product.model + ' - MinerHive'}">Майнер - MinerHive</title>
    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{/assets/images/logo/favicon.png}" href="assets/images/logo/favicon.png">

    <!-- Bootstrap -->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}" href="assets/css/bootstrap.min.css">
    <!-- select 2 -->
    <link rel="stylesheet" th:href="@{/assets/css/select2.min.css}" href="assets/css/select2.min.css">
    <!-- Slick -->
    <link rel="stylesheet" th:href="@{/assets/css/slick.css}" href="assets/css/slick.css">
    <!-- jQuery UI -->
    <link rel="stylesheet" th:href="@{/assets/css/jquery-ui.css}" href="assets/css/jquery-ui.css">
    <!-- Main css -->
    <link rel="stylesheet" th:href="@{/assets/css/main.css}" href="assets/css/main.css">
    <!-- Custom styles для таблицы предложений -->
    <style>
        /* Предотвращаем перенос текста в ссылках header-top */
        .header-top ul li a {
            white-space: nowrap !important;
        }
        
        /* Убираем верхний отступ у секции деталей товара */
        .product-details.py-80 {
            padding-top: 0 !important;
        }
        
        /* Деловой стиль таблицы предложений */
        .offers-table {
            font-size: 0.875rem;
            border-collapse: collapse;
            width: 100%;
        }
        
        .offers-table thead th {
            background-color: #2c3e50;
            color: #ffffff;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
            padding: 8px 12px;
            border: 1px solid #34495e;
            white-space: nowrap;
        }
        
        .offers-table tbody td {
            padding: 6px 12px;
            border: 1px solid #e0e0e0;
            vertical-align: middle;
        }
        
        .offers-table tbody tr {
            height: 28px;
            transition: background-color 0.15s ease;
        }
        
        .offers-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .offers-table tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }
        
        .offers-table tbody tr:hover {
            background-color: #e8f4f8;
        }
        
        .offers-table thead tr th.sortable {
            cursor: pointer;
            user-select: none;
        }
        
        .offers-table thead tr th.sortable:hover {
            background-color: #34495e;
        }
        
        .offers-table .badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            font-weight: 500;
        }
        
        .offers-table tbody td span {
            font-size: 0.875rem;
        }
        
        /* Компактные размеры для ячеек */
        .offers-table th,
        .offers-table td {
            line-height: 1.3;
        }
        
        /* Стили для колонки примечаний - раскрывающийся текст */
        .offers-table tbody td:nth-child(7) {
            max-width: 200px;
            min-width: 120px;
            white-space: normal !important;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            vertical-align: top;
            padding-top: 8px;
            padding-bottom: 8px;
        }
        
        .offers-table tbody td:nth-child(7) span {
            display: block;
            line-height: 1.4;
            max-height: 3.6em; /* Примерно 3 строки */
            overflow: hidden;
            text-overflow: ellipsis;
            position: relative;
        }
        
        .offers-table tbody td:nth-child(7) span.expanded {
            max-height: none;
        }
        
        .offers-table tbody td:nth-child(7) .expand-toggle {
            color: #2563eb;
            cursor: pointer;
            font-size: 0.7rem;
            margin-top: 4px;
            display: inline-block;
            text-decoration: underline;
        }
        
        .offers-table tbody td:nth-child(7) .expand-toggle:hover {
            color: #1d4ed8;
        }
        
        /* Для мобильных устройств */
        @media screen and (max-width: 768px) {
            .offers-table tbody td:nth-child(7) {
                max-width: 150px;
                min-width: 100px;
                font-size: 0.65rem !important;
            }
            
            .offers-table tbody td:nth-child(7) span {
                max-height: 2.6em; /* Примерно 2 строки на мобильных */
            }
        }
        
        /* Стили для мобильной версии таблицы */
        @media screen and (max-width: 768px) {
            .offers-table {
                font-size: 0.75rem !important;
            }
            
            .offers-table thead th {
                font-size: 0.65rem !important;
                padding: 6px 8px !important;
                letter-spacing: 0.3px;
            }
            
            .offers-table tbody td {
                padding: 4px 8px !important;
                font-size: 0.7rem !important;
            }
            
            .offers-table tbody tr {
                height: auto !important;
                min-height: 32px;
            }
            
            .offers-table .badge {
                font-size: 0.6rem !important;
                padding: 2px 6px !important;
            }
            
            .offers-table tbody td span {
                font-size: 0.7rem !important;
            }
            
            /* Уменьшаем минимальную ширину колонок */
            .offers-table th,
            .offers-table td {
                min-width: auto !important;
                white-space: nowrap;
            }
            
            /* Делаем таблицу горизонтально прокручиваемой на очень маленьких экранах */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        @media screen and (max-width: 576px) {
            .offers-table {
                font-size: 0.7rem !important;
            }
            
            .offers-table thead th {
                font-size: 0.6rem !important;
                padding: 5px 6px !important;
            }
            
            .offers-table tbody td {
                padding: 3px 6px !important;
                font-size: 0.65rem !important;
            }
            
            .offers-table .badge {
                font-size: 0.55rem !important;
                padding: 2px 5px !important;
            }
        }
        
        /* Стили для пагинации на мобильных устройствах */
        @media screen and (max-width: 768px) {
            .pagination .page-link {
                padding: 8px 12px !important;
                font-size: 0.875rem !important;
                min-height: 38px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .pagination .page-item:first-child .page-link,
            .pagination .page-item:last-child .page-link {
                padding: 8px 16px !important;
                font-size: 0.875rem !important;
            }
        }
        
        @media screen and (max-width: 576px) {
            .pagination .page-link {
                padding: 6px 10px !important;
                font-size: 0.8rem !important;
                min-height: 36px !important;
            }
            
            .pagination .page-item:first-child .page-link,
            .pagination .page-item:last-child .page-link {
                padding: 6px 12px !important;
                font-size: 0.8rem !important;
            }
        }
        
        /* Стили для кнопки "Заявка" на мобильных устройствах */
        @media screen and (max-width: 768px) {
            .offers-table tbody td .btn {
                padding: 6px 12px !important;
                font-size: 0.75rem !important;
                min-height: 32px !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 4px !important;
            }
            
            .offers-table tbody td .btn i {
                font-size: 0.875rem !important;
            }
            
            .offers-table tbody td .btn span {
                font-size: 0.75rem !important;
            }
        }
        
        @media screen and (max-width: 576px) {
            .offers-table tbody td .btn {
                padding: 5px 10px !important;
                font-size: 0.7rem !important;
                min-height: 30px !important;
                gap: 3px !important;
            }
            
            .offers-table tbody td .btn i {
                font-size: 0.8rem !important;
            }
            
            .offers-table tbody td .btn span {
                font-size: 0.7rem !important;
            }
        }
        
        /* Стили для альбома фотографий товара */
        .product-details__thumbnails {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .product-details__thumbnails .product-details__images-slider > div {
            margin-bottom: 0;
        }
        
        .product-details__thumbnails .thumbnail-item {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .product-details__thumbnails .thumbnail-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .product-details__thumbnails .thumbnail-item.active {
            border-color: var(--main-two-600, #007bff) !important;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        /* Адаптивность для мобильных устройств */
        @media (max-width: 768px) {
            .product-details__left .d-flex {
                flex-direction: column !important;
            }
            
            .product-details__thumbnails {
                display: flex !important;
                flex-direction: row !important;
                overflow-x: auto;
                max-height: none;
                gap: 8px;
            }
        }
    </style>
</head> 
<body>
    
<!--==================== Preloader Start ====================-->
  <div class="preloader">
    <img th:src="@{/assets/images/icon/preloader.gif}" src="assets/images/icon/preloader.gif" alt="">
  </div>
<!--==================== Preloader End ====================-->

<!--==================== Overlay Start ====================-->
<div class="overlay"></div>
<!--==================== Overlay End ====================-->

<!--==================== Sidebar Overlay Start ====================-->
<div class="side-overlay"></div>
<!--==================== Sidebar Overlay End ====================-->

<!-- ==================== Scroll to Top Start ==================== -->
<div class="progress-wrap">
  <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
      <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
  </svg>
</div>
<!-- ==================== Scroll to Top End ==================== -->

<!-- ==================== Search Box Start ==================== -->
 <form action="#" class="search-box">
  <button type="button" class="search-box__close position-absolute inset-block-start-0 inset-inline-end-0 m-16 w-48 h-48 border border-gray-100 rounded-circle flex-center text-white hover-text-gray-800 hover-bg-white text-2xl transition-1">
    <i class="ph ph-x"></i>
  </button>
  <div class="container">
    <div class="position-relative">
      <input type="text" class="form-control py-16 px-24 text-xl rounded-pill pe-64" placeholder="Поиск майнеров...">
      <button type="submit" class="w-48 h-48 bg-main-two-600 rounded-circle flex-center text-xl text-white position-absolute top-50 translate-middle-y inset-inline-end-0 me-8">
        <i class="ph ph-magnifying-glass"></i>
      </button>
    </div>
  </div>
 </form>
<!-- ==================== Search Box End ==================== -->

<!-- ==================== Mobile Menu Start ==================== -->
<div class="mobile-menu scroll-sm d-lg-none d-block">
    <button type="button" class="close-button"> <i class="ph ph-x"></i> </button>
    <div class="mobile-menu__inner">
        <a th:href="@{/}" class="mobile-menu__logo">
            <img th:src="@{/assets/images/logo/logo.png}" src="/assets/images/logo/logo.png" alt="MinerHive Logo">
        </a>
        <div class="mobile-menu__menu">
            <!-- Nav Menu Start -->
<ul class="nav-menu flex-align nav-menu--mobile">
    <li class="nav-menu__item">
        <a th:href="@{/}" class="nav-menu__link">Главная</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/products}" class="nav-menu__link">Товары</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/about}" class="nav-menu__link">О нас</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/delivery}" class="nav-menu__link">Доставка</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/services}" class="nav-menu__link">Услуги</a>
    </li>
</ul>
<!-- Nav Menu End -->
        </div>
    </div>
</div>
<!-- ==================== Mobile Menu End ==================== -->

    <!-- ======================= Header Top Start ========================= -->
<div class="header-top bg-main-two-600 flex-between">
    <div class="container container-lg">
        <div class="flex-between flex-nowrap gap-8">
            <ul class="flex-align flex-nowrap">
                <li class="border-right-item"><a th:href="@{/about}" class="text-white text-sm hover-text-decoration-underline">О нас</a></li>
                <li class="border-right-item"><a th:href="@{/delivery}" class="text-white text-sm hover-text-decoration-underline">Доставка</a></li>
                <li class="border-right-item"><a th:href="@{/services}" class="text-white text-sm hover-text-decoration-underline">Услуги</a></li>
            </ul>
            <ul class="header-top__right flex-align flex-nowrap">
                <li class="border-right-item">
                    <a th:href="@{/products}" class="text-white text-sm py-8 flex-align gap-6"> 
                        <span class="icon text-md d-flex"> <i class="ph ph-box"></i> </span> 
                        <span class="hover-text-decoration-underline">Товары</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!-- ======================= Header Top End ========================= -->

    <!-- ======================= Middle Header Two Start ========================= -->
<header class="header-middle style-two bg-color-neutral">
    <div class="container container-lg">
        <nav class="header-inner flex-between">
            <!-- Logo Start -->
            <div class="logo">
                <a th:href="@{/}" class="link">
                    <img th:src="@{/assets/images/logo/logo-two.png}" src="/assets/images/logo/logo-two.png" alt="MinerHive Logo">
                </a>
            </div>
            <!-- Logo End  -->

            <!-- form Category Start -->
            <div class="flex-align gap-16">
                <form action="#" class="flex-align flex-wrap form-location-wrapper">
                    <div class="search-category style-two d-flex h-48 search-form d-sm-flex d-none">
                        <div class="search-form__wrapper position-relative">
                            <input type="text" class="search-form__input common-input py-13 ps-16 pe-18 rounded-0 border-0" placeholder="Поиск майнеров...">
                        </div>
                        <button type="submit" class="bg-main-two-600 flex-center text-xl text-white flex-shrink-0 w-48 hover-bg-main-two-700 d-lg-flex d-none"><i class="ph ph-magnifying-glass"></i></button>
                    </div>
                </form>
            </div>
            <!-- form Category End -->
             
            <!-- Header Middle Right start -->
            <div class="header-right flex-align d-lg-block d-none">
                <div class="header-two-activities flex-align flex-wrap gap-32">
                    <button type="button" class="flex-align search-icon d-lg-none d-flex gap-4 item-hover-two">
                        <span class="text-2xl text-white d-flex position-relative item-hover__text">
                            <i class="ph ph-magnifying-glass"></i>
                        </span>
                    </button>
                    <a th:href="@{/products}" class="flex-align flex-column gap-8 item-hover-two">
                        <span class="text-2xl text-white d-flex position-relative item-hover__text">
                            <i class="ph ph-box"></i>
                        </span>
                        <span class="text-md text-white item-hover__text d-none d-lg-flex">Товары</span>
                    </a>
                </div>
            </div>
            <!-- Header Middle Right End  -->
        </nav>
    </div>
</header>
<!-- ======================= Middle Header Two End ========================= -->

    <!-- ==================== Header Start ==================== -->
<header class="header bg-white border-bottom border-gray-100">
    <div class="container container-lg">
        <nav class="header-inner d-flex justify-content-between gap-8">
            <!-- Menu Start  -->
            <div class="header-menu d-lg-block d-none flex-grow-1">
                <!-- Nav Menu Start -->
<ul class="nav-menu flex-align">
    <li class="nav-menu__item">
        <a th:href="@{/}" class="nav-menu__link">Главная</a>
    </li>
    <li class="nav-menu__item">
        <a th:href="@{/products}" class="nav-menu__link">Товары</a>
    </li>
</ul>
<!-- Nav Menu End -->
            </div>
        </nav>
    </div>
</header>
<!-- ==================== Header End ==================== -->

    <!-- ========================= Breadcrumb Start =============================== -->
<div class="breadcrumb py-26 bg-main-two-50">
    <div class="container container-lg">
        <div class="breadcrumb-wrapper flex-between flex-wrap gap-16">
            <h6 class="mb-0">Детали товара</h6>
            <ul class="flex-align gap-8 flex-wrap">
                <li class="text-sm">
                    <a th:href="@{/}" class="text-gray-900 flex-align gap-8 hover-text-main-two-600">
                        <i class="ph ph-house"></i>
                        Главная
                    </a>
                </li>
                <li class="flex-align">
                    <i class="ph ph-caret-right"></i>
                </li>
                <li class="text-sm">
                    <a th:href="@{/products}" class="text-gray-900 flex-align gap-8 hover-text-main-two-600">
                        Товары
                    </a>
                </li>
                <li class="flex-align">
                    <i class="ph ph-caret-right"></i>
                </li>
                <li class="flex-align">
                    <i class="ph ph-caret-right"></i>
                </li>
                <li class="text-sm text-main-two-600" th:utext="${minerDetail != null && minerDetail.standardName != null ? minerDetail.standardName : product.model}">Модель майнера</li>
            </ul>
        </div>
    </div>
</div>
<!-- ========================= Breadcrumb End =============================== -->

    <!-- ========================== Product Details Two Start =========================== -->
<section class="product-details py-80">
    <div class="container container-lg">
        <div class="row gy-4">
            <div class="col-xl-12">
                <div class="row gy-4">
                    <div class="col-xl-6">
                        <div class="product-details__left">
                            <!-- Контейнер для основного изображения и миниатюр -->
                            <div class="d-flex gap-16" style="align-items: flex-start;">
                                <!-- Миниатюры (слева от основного изображения) -->
                                <div class="product-details__thumbnails" th:if="${product.imageUrl != null && !#strings.isEmpty(product.imageUrl)}" style="display: flex; flex-direction: column; gap: 12px; flex-shrink: 0;">
                                    <div class="product-details__images-slider">
                                        <div>
                                            <div class="max-w-120 max-h-120 h-100 flex-center border border-gray-100 rounded-16 p-8 cursor-pointer thumbnail-item" onclick="changeMainImage(this)">
                                                <img th:src="@{${product.imageUrl}}" th:alt="${minerDetail != null && minerDetail.standardName != null ? minerDetail.standardName : product.model}" style="max-width: 100%; max-height: 100%; object-fit: contain;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Главное изображение товара -->
                                <div class="product-details__thumb-slider border border-gray-100 rounded-16" style="flex: 1;">
                                    <div class="">
                                        <div class="product-details__thumb flex-center h-100">
                                            <img id="mainProductImage" th:if="${product.imageUrl != null && !#strings.isEmpty(product.imageUrl)}" 
                                                 th:src="@{${product.imageUrl}}" 
                                                 th:alt="${minerDetail != null && minerDetail.standardName != null ? minerDetail.standardName : product.model}"
                                                 alt="Майнер"
                                                 style="max-width: 100%; max-height: 500px; object-fit: contain; padding: 20px;"
                                                 onerror="this.onerror=null; this.src='/assets/images/thumbs/product-img1.png';">
                                            <div th:unless="${product.imageUrl != null && !#strings.isEmpty(product.imageUrl)}" 
                                                 class="flex-center h-100 flex-column text-gray-400">
                                                <i class="ph ph-image text-6xl mb-16"></i>
                                                <p class="text-sm">Фото товара</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-6">
                        <div class="product-details__content">
                            
                            <!-- Бейдж типа операции -->
                            <div class="mb-24" th:if="${!#lists.isEmpty(sellOffers) || !#lists.isEmpty(buyOffers)}">
                                <div class="flex-align gap-16 flex-wrap">
                                    <span th:if="${!#lists.isEmpty(sellOffers) && #lists.isEmpty(buyOffers)}" 
                                          class="badge bg-success text-white px-16 py-8 rounded-8">
                                        <i class="ph ph-arrow-down-circle"></i> Продажа
                                    </span>
                                    <span th:if="${#lists.isEmpty(sellOffers) && !#lists.isEmpty(buyOffers)}" 
                                          class="badge bg-info text-white px-16 py-8 rounded-8">
                                        <i class="ph ph-arrow-up-circle"></i> Покупка
                                    </span>
                                    <span th:if="${!#lists.isEmpty(sellOffers) && !#lists.isEmpty(buyOffers)}" 
                                          class="badge bg-warning text-dark px-16 py-8 rounded-8">
                                        <i class="ph ph-arrow-left-right"></i> Продажа/Покупка
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Название товара -->
                            <h5 class="mb-12" th:utext="${minerDetail != null && minerDetail.standardName != null ? minerDetail.standardName : product.model}">Модель майнера</h5>
                            
                            <!-- Количество предложений -->
                            <div class="flex-align flex-wrap gap-12 mb-24">
                                <span class="text-gray-900">
                                    <span class="text-gray-400">Предложений:</span>
                                    <span class="fw-medium" th:text="${offersPage != null ? offersPage.totalElements : 0}">0</span>
                                </span>
                                <span class="text-sm fw-medium text-gray-500">|</span>
                                <span class="text-gray-900">
                                    <span class="text-gray-400">Продажи:</span>
                                    <span class="badge bg-success" th:text="${#lists.size(sellOffers)}">0</span>
                                </span>
                                <span class="text-gray-900">
                                    <span class="text-gray-400">Покупки:</span>
                                    <span class="badge bg-info" th:text="${#lists.size(buyOffers)}">0</span>
                                </span>
                            </div>
                            
                            <span class="mt-32 pt-32 text-gray-700 border-top border-gray-100 d-block"></span>
                            
                            <!-- Описание товара -->
                            <p class="text-gray-700 mt-24" th:if="${minerDetail != null && minerDetail.description != null && !#strings.isEmpty(minerDetail.description)}" th:utext="${minerDetail.description}">
                                Описание товара
                            </p>
                            <p class="text-gray-700 mt-24" th:if="${(minerDetail == null || minerDetail.description == null || #strings.isEmpty(minerDetail.description)) && product.description != null && !#strings.isEmpty(product.description)}" th:utext="${product.description}">
                                Описание товара
                            </p>
                            <p class="text-gray-500 mt-24" th:if="${(minerDetail == null || minerDetail.description == null || #strings.isEmpty(minerDetail.description)) && (product.description == null || #strings.isEmpty(product.description))}">
                                Описание не указано
                            </p>

                            <!-- Цена -->
                            <div class="my-32 flex-align gap-16 flex-wrap" th:if="${minPrice != null && minPrice.doubleValue() > 0}">
                                <div class="flex-align gap-8">
                                    <h6 class="mb-0 text-main-two-600" th:text="${#numbers.formatDecimal(minPrice, 0, 'COMMA', 0, 'POINT') + ' ' + currency}">Цена</h6>
                                </div>
                                <div class="flex-align gap-8">
                                    <span class="text-gray-700">Цена от</span>
                                </div>
                            </div>
                            <div class="my-32" th:if="${minPrice == null || (minPrice != null && minPrice.doubleValue() <= 0)}">
                                <span class="text-gray-500">Цена не указана</span>
                            </div>
                            
                            <span class="mt-32 pt-32 text-gray-700 border-top border-gray-100 d-block"></span>

                            <!-- Краткая информация -->
                            <div class="mt-32">
                                <h6 class="mb-16">Краткая информация</h6>
                                <ul class="mt-16">
                                    <li class="text-gray-700 mb-12 flex-align gap-12" th:if="${minerDetail != null && minerDetail.manufacturer != null && !#strings.isEmpty(minerDetail.manufacturer)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Производитель:
                                            <span class="text-gray-500" th:utext="${minerDetail.manufacturer}">Производитель</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-700 mb-12 flex-align gap-12" th:if="${minerDetail != null && minerDetail.hashrate != null && !#strings.isEmpty(minerDetail.hashrate)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Хэшрейт:
                                            <span class="text-gray-500" th:utext="${minerDetail.hashrate}">Хэшрейт</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-700 mb-12 flex-align gap-12" th:if="${minerDetail != null && minerDetail.powerConsumption != null && !#strings.isEmpty(minerDetail.powerConsumption)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Потребляемая мощность:
                                            <span class="text-gray-500" th:utext="${minerDetail.powerConsumption}">Потребляемая мощность</span>
                                        </span>
                                    </li>
                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Блок с информацией о CompanyMiner (если используется) -->
        <div class="pt-80" th:if="${useCompanyMiner != null && useCompanyMiner == true && companyMiner != null}">
            <div class="border rounded-24 p-32">
                <h6 class="mb-24 fw-semibold">Предложение компании</h6>
                
                <div class="row g-24">
                    <!-- Цена -->
                    <div class="col-md-6" th:if="${companyMiner.price != null}">
                        <div class="d-flex align-items-center gap-12">
                            <span class="text-gray-600 fw-medium">Цена:</span>
                            <span class="text-heading fw-semibold" th:text="${companyMiner.price + ' ' + (companyMiner.currencySymbol != null ? companyMiner.currencySymbol : companyMiner.currencyCode)}">Цена</span>
                            <span class="text-gray-500 text-sm" th:if="${companyMiner.priceOld != null && companyMiner.priceOld.doubleValue() > 0}">
                                <del th:text="${companyMiner.priceOld + ' ' + (companyMiner.currencySymbol != null ? companyMiner.currencySymbol : companyMiner.currencyCode)}">Старая цена</del>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Хэшрейт -->
                    <div class="col-md-6" th:if="${companyMiner.hashrateMin != null}">
                        <div class="d-flex align-items-center gap-12">
                            <span class="text-gray-600 fw-medium">Хэшрейт:</span>
                            <span class="text-heading" th:text="${companyMiner.hashrateMin + (companyMiner.hashrateMax != null ? ' - ' + companyMiner.hashrateMax : '') + ' ' + (companyMiner.hashrateUnitAbbreviation != null ? companyMiner.hashrateUnitAbbreviation : '')}">Хэшрейт</span>
                        </div>
                    </div>
                    
                    <!-- Количество -->
                    <div class="col-md-6" th:if="${companyMiner.quantity != null}">
                        <div class="d-flex align-items-center gap-12">
                            <span class="text-gray-600 fw-medium">Количество:</span>
                            <span class="text-heading" th:text="${companyMiner.quantity}">Количество</span>
                        </div>
                    </div>
                    
                    <!-- Состояние -->
                    <div class="col-md-6" th:if="${companyMiner.condition != null && !#strings.isEmpty(companyMiner.condition)}">
                        <div class="d-flex align-items-center gap-12">
                            <span class="text-gray-600 fw-medium">Состояние:</span>
                            <span class="text-heading" th:utext="${companyMiner.condition}">Состояние</span>
                        </div>
                    </div>
                </div>
                
                <!-- Дополнительные поля -->
                <div class="mt-24" th:if="${companyMiner.customFields != null && !#lists.isEmpty(companyMiner.customFields)}">
                    <h6 class="mb-16 fw-semibold">Дополнительная информация</h6>
                    <div class="row g-16">
                        <div class="col-md-6" th:each="field : ${companyMiner.customFields}">
                            <div class="d-flex align-items-start gap-12">
                                <span class="text-gray-600 fw-medium" th:text="${field.fieldName + ':'}">Поле:</span>
                                <span class="text-heading" th:utext="${field.fieldValue}">Значение</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Кнопка создания запроса -->
                <div class="mt-32">
                    <button type="button" 
                            class="btn btn-main-two btn-lg w-100" 
                            th:onclick="'openCompanyMinerRequestModal(' + ${companyMiner.id} + ')'">
                        <i class="ph ph-paper-plane-tilt"></i> Отправить заявку
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Блок с таблицей предложений (показывается только если нет CompanyMiner или есть предложения) -->
        <div class="pt-80" th:if="${(useCompanyMiner == null || useCompanyMiner == false) && offersPage != null && offersPage.totalElements > 0}">
            <div class="border rounded-24 p-32">
                <div class="flex-between flex-wrap gap-16 mb-24">
                    <div class="flex-align gap-8 flex-wrap">
                        <h6 class="mb-0 fw-semibold">Предложения по данному товару</h6>
                    </div>
                    
                    <!-- Фильтры по дате -->
                    <div class="flex-align gap-8 flex-wrap date-filters">
                        <button type="button" 
                                class="btn btn-sm date-filter-btn" 
                                data-filter="today"
                                th:classappend="${dateFilter == 'today'} ? 'btn-main-two' : 'btn-outline-main-two'"
                                style="padding: 6px 12px; font-size: 0.875rem;">
                            Сегодня
                        </button>
                        <button type="button" 
                                class="btn btn-sm date-filter-btn" 
                                data-filter="3days"
                                th:classappend="${dateFilter == '3days'} ? 'btn-main-two' : 'btn-outline-main-two'"
                                style="padding: 6px 12px; font-size: 0.875rem;">
                            3 дня
                        </button>
                        <button type="button" 
                                class="btn btn-sm date-filter-btn" 
                                data-filter="week"
                                th:classappend="${dateFilter == 'week'} ? 'btn-main-two' : 'btn-outline-main-two'"
                                style="padding: 6px 12px; font-size: 0.875rem;">
                            Неделя
                        </button>
                        <button type="button" 
                                class="btn btn-sm date-filter-btn" 
                                data-filter="month"
                                th:classappend="${dateFilter == 'month'} ? 'btn-main-two' : 'btn-outline-main-two'"
                                style="padding: 6px 12px; font-size: 0.875rem;">
                            Месяц
                        </button>
                        <button type="button" 
                                class="btn btn-sm date-filter-btn" 
                                data-filter=""
                                th:classappend="${dateFilter == '' || dateFilter == null} ? 'btn-main-two' : 'btn-outline-main-two'"
                                style="padding: 6px 12px; font-size: 0.875rem;">
                            Все
                        </button>
                    </div>
                </div>
                
                <!-- Дополнительные фильтры - перенесены влево к краю таблицы, уменьшены в 3 раза, в цвете сайта -->
                <div class="flex-align gap-3 flex-wrap additional-filters mb-16" style="align-items: flex-start;">
                    <button type="button" 
                            class="btn btn-outline-main-two operation-filter-btn" 
                            data-operation="SELL"
                            style="padding: 3px 8px; font-size: 0.6rem; line-height: 1.3; min-height: auto; border-width: 1px; white-space: nowrap;">
                        Продажа
                    </button>
                    <button type="button" 
                            class="btn btn-outline-main-two operation-filter-btn" 
                            data-operation="BUY"
                            style="padding: 3px 8px; font-size: 0.6rem; line-height: 1.3; min-height: auto; border-width: 1px; white-space: nowrap;">
                        Покупка
                    </button>
                    <button type="button" 
                            class="btn btn-outline-main-two has-price-filter-btn" 
                            data-has-price="true"
                            style="padding: 3px 8px; font-size: 0.6rem; line-height: 1.3; min-height: auto; border-width: 1px; white-space: nowrap;">
                        Без пустых цен
                    </button>
                </div>
                
                <!-- Выбор количества записей на странице -->
                <div class="flex-between flex-wrap gap-16 mb-16">
                    <div class="flex-align gap-8">
                        <span class="text-sm text-gray-600">Показать:</span>
                        <select id="pageSizeSelect" class="form-select form-select-sm" style="width: auto; display: inline-block;">
                            <option th:value="10" th:selected="${pageSize == 10 || pageSize == null}">10</option>
                            <option th:value="20" th:selected="${pageSize == 20}">20</option>
                            <option th:value="50" th:selected="${pageSize == 50}">50</option>
                            <option th:value="100" th:selected="${pageSize == 100}">100</option>
                        </select>
                        <span class="text-sm text-gray-600">записей</span>
                    </div>
                    <div class="text-sm text-gray-600" id="recordsInfo" th:if="${offersPage != null}">
                        Показано <span th:text="${offersPage.number * offersPage.size + 1}">1</span> - 
                        <span th:text="${offersPage.number * offersPage.size + #lists.size(offersPage.content)}">0</span> из 
                        <span th:text="${offersPage.totalElements}">0</span>
                    </div>
                </div>
                
                <!-- Таблица предложений -->
                <div class="table-responsive">
                    <table class="offers-table" id="offersTable">
                                        <thead>
                                            <tr>
                                                <th class="sortable" data-sort="operationType" data-column="0">
                                                    Тип
                                                    <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="hashrate" data-column="1">
                                                    Хэшрейт
                                                    <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="quantity" data-column="2">
                                                    Кол-во
                                                    <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="price" data-column="3">
                                                    Цена
                                                    <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="condition" data-column="4">
                                                    Состояние
                                                    <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="location" data-column="5">
                                                    Локация
                                                    <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="notes" data-column="6">
                                                    Примечания
                                                    <span class="sort-icon"></span>
                                                </th>
                                                <th class="sortable" data-sort="updatedAt" data-column="7">
                                                    Дата
                                                    <span class="sort-icon"></span>
                                                </th>
                                                <th style="width: 150px;">Действия</th>
                                            </tr>
                                        </thead>
                                        <tbody id="offersTableBody">
                                            <!-- Начальные данные загружаются из сервера -->
                                            <tr th:each="offer : ${offersPage != null ? offersPage.content : #lists.list()}">
                                                <td>
                                                    <span th:if="${offer.operationType != null && offer.operationType.name() == 'SELL'}" 
                                                          class="badge bg-success">Продажа</span>
                                                    <span th:if="${offer.operationType != null && offer.operationType.name() == 'BUY'}" 
                                                          class="badge bg-info">Покупка</span>
                                                    <span th:if="${offer.operationType == null}" 
                                                          class="badge bg-secondary">Не указано</span>
                                                </td>
                                                <td>
                                                    <span th:if="${offer.hashrate != null && !offer.hashrate.isEmpty()}" 
                                                          th:utext="${offer.hashrate}">-</span>
                                                    <span th:if="${offer.hashrate == null || offer.hashrate.isEmpty()}" 
                                                          class="text-gray-400">-</span>
                                                </td>
                                                <td th:text="${offer.quantity != null ? offer.quantity + ' шт.' : '-'}">-</td>
                                                <td>
                                                    <span th:if="${offer.price != null}" 
                                                          th:classappend="${offer.operationType != null && offer.operationType.name() == 'BUY'} ? 'text-info fw-bold' : 'text-success fw-bold'">
                                                        <span th:text="${offer.price}"></span>
                                                        <span th:if="${offer.currency != null and !offer.currency.isEmpty()}" th:utext="' ' + ${offer.currency}"></span>
                                                    </span>
                                                    <span th:if="${offer.price == null}" class="text-gray-400">-</span>
                                                </td>
                                                <td>
                                                    <span th:if="${offer.condition != null && !offer.condition.isEmpty()}" 
                                                          th:utext="${offer.condition}">-</span>
                                                    <span th:if="${offer.condition == null || offer.condition.isEmpty()}" 
                                                          class="text-gray-400">-</span>
                                                </td>
                                                <td>
                                                    <span th:if="${offer.location != null && !offer.location.isEmpty()}" 
                                                          th:utext="${offer.location}">-</span>
                                                    <span th:if="${offer.location == null || offer.location.isEmpty()}" 
                                                          class="text-gray-400">-</span>
                                                </td>
                                                <td style="max-width: 200px;">
                                                    <div th:if="${offer.notes != null && !offer.notes.isEmpty()}">
                                                        <span class="text-muted small notes-text" 
                                                              th:utext="${offer.notes}">Примечания</span>
                                                        <span class="expand-toggle" 
                                                              onclick="toggleNotes(this)" 
                                                              style="display: none;">Показать больше</span>
                                                    </div>
                                                    <span th:if="${offer.notes == null || offer.notes.isEmpty()}" 
                                                          class="text-gray-400">-</span>
                                                </td>
                                                <td th:text="${#temporals.format(offer.updatedAt, 'dd.MM.yyyy HH:mm')}">Дата</td>
                                                <td>
                                                    <button type="button" 
                                                            class="btn btn-sm btn-main-two" 
                                                            th:attr="data-offer-id=${offer.id}"
                                                            onclick="openRequestModal(this.getAttribute('data-offer-id'))"
                                                            style="white-space: nowrap; padding: 4px 8px; font-size: 0.75rem;">
                                                        <i class="ph ph-paper-plane-tilt"></i> <span>Заявка</span>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                    </table>
                </div>
                
                <!-- Пагинация -->
                <div class="mt-24" id="paginationContainer" style="display: none;">
                    <nav>
                        <ul class="pagination justify-content-center mb-0" id="paginationList">
                            <!-- Пагинация будет обновляться через JavaScript -->
                            <th:block th:if="${offersPage != null && offersPage.totalPages > 1}">
                                <li class="page-item" th:classappend="${offersPage.first} ? 'disabled' : ''">
                                    <a class="page-link" href="#" th:attr="data-page=${offersPage.number - 1}">Предыдущая</a>
                                </li>
                                <li th:each="pageNum : ${#numbers.sequence(0, offersPage.totalPages - 1)}"
                                    class="page-item" th:classappend="${pageNum == offersPage.number} ? 'active' : ''">
                                    <a class="page-link" href="#" th:attr="data-page=${pageNum}" th:text="${pageNum + 1}">1</a>
                                </li>
                                <li class="page-item" th:classappend="${offersPage.last} ? 'disabled' : ''">
                                    <a class="page-link" href="#" th:attr="data-page=${offersPage.number + 1}">Следующая</a>
                                </li>
                            </th:block>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Пустое состояние для предложений -->
        <div class="pt-80 text-center py-80" th:if="${offersPage == null || offersPage.totalElements == 0}">
            <div class="border rounded-24 p-32">
                <div class="w-120 h-120 bg-gray-100 rounded-circle flex-center mx-auto mb-24">
                    <i class="ph ph-inbox text-gray-400" style="font-size: 3rem;"></i>
                </div>
                <h5 class="text-gray-600 mb-8">Предложений пока нет</h5>
                <p class="text-gray-500">Предложения появятся автоматически после обработки сообщений из WhatsApp</p>
            </div>
        </div>

        <!-- Табы с описанием -->
        <div class="pt-80">
            <div class="product-dContent border rounded-24">
                <div class="product-dContent__header border-bottom border-gray-100 flex-between flex-wrap gap-16">
                    <ul class="nav common-tab nav-pills mb-3" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                          <button class="nav-link active" id="pills-description-tab" data-bs-toggle="pill" data-bs-target="#pills-description" type="button" role="tab" aria-controls="pills-description" aria-selected="true">Описание</button>
                        </li>
                    </ul>
                </div>
                <div class="product-dContent__box">
                    <div class="tab-content" id="pills-tabContent">
                        <!-- Tab Описание -->
                        <div class="tab-pane fade show active" id="pills-description" role="tabpanel" aria-labelledby="pills-description-tab" tabindex="0">
                            <div class="mb-40">
                                <h6 class="mb-24">Описание товара</h6>
                                <p th:if="${minerDetail != null && minerDetail.description != null && !#strings.isEmpty(minerDetail.description)}" th:utext="${minerDetail.description}">
                                    Описание товара
                                </p>
                                <p th:if="${(minerDetail == null || minerDetail.description == null || #strings.isEmpty(minerDetail.description)) && product.description != null && !#strings.isEmpty(product.description)}" th:utext="${product.description}">
                                    Описание товара
                                </p>
                                <p th:if="${(minerDetail == null || minerDetail.description == null || #strings.isEmpty(minerDetail.description)) && (product.description == null || #strings.isEmpty(product.description))}" class="text-gray-500">
                                    Описание не указано
                                </p>
                            </div>
                            <div class="mb-40">
                                <h6 class="mb-24">Характеристики</h6>
                                <ul class="mt-32">
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.series != null && !#strings.isEmpty(minerDetail.series)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Серия:
                                            <span class="text-gray-500" th:utext="${minerDetail.series}">Серия</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.algorithm != null && !#strings.isEmpty(minerDetail.algorithm)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Алгоритм:
                                            <span class="text-gray-500" th:utext="${minerDetail.algorithm}">Алгоритм</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.noiseLevel != null && !#strings.isEmpty(minerDetail.noiseLevel)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Уровень шума:
                                            <span class="text-gray-500" th:utext="${minerDetail.noiseLevel}">Уровень шума</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.cooling != null && !#strings.isEmpty(minerDetail.cooling)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Охлаждение:
                                            <span class="text-gray-500" th:utext="${minerDetail.cooling}">Охлаждение</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.operatingTemperature != null && !#strings.isEmpty(minerDetail.operatingTemperature)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Рабочая температура:
                                            <span class="text-gray-500" th:utext="${minerDetail.operatingTemperature}">Рабочая температура</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.dimensions != null && !#strings.isEmpty(minerDetail.dimensions)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Размеры:
                                            <span class="text-gray-500" th:utext="${minerDetail.dimensions}">Размеры</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.coins != null && !#strings.isEmpty(minerDetail.coins)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Добываемые монеты:
                                            <span class="text-gray-500" th:utext="${minerDetail.coins}">Монеты</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.powerSource != null && !#strings.isEmpty(minerDetail.powerSource)}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Источник питания:
                                            <span class="text-gray-500" th:utext="${minerDetail.powerSource}">Источник питания</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${offersPage != null && offersPage.totalElements > 0}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Количество предложений:
                                            <span class="text-gray-500" th:text="${offersPage != null ? offersPage.totalElements : 0}">0</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.createdAt != null}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Дата создания:
                                            <span class="text-gray-500" th:text="${#temporals.format(minerDetail.createdAt, 'dd.MM.yyyy HH:mm')}">Дата</span>
                                        </span>
                                    </li>
                                    <li class="text-gray-400 mb-14 flex-align gap-14" th:if="${minerDetail != null && minerDetail.updatedAt != null}">
                                        <span class="w-20 h-20 bg-main-two-50 text-main-two-600 text-xs flex-center rounded-circle">
                                            <i class="ph ph-check"></i>
                                        </span>
                                        <span class="text-heading fw-medium">
                                            Последнее обновление:
                                            <span class="text-gray-500" th:text="${#temporals.format(minerDetail.updatedAt, 'dd.MM.yyyy HH:mm')}">Дата</span>
                                        </span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- ========================== Product Details Two End =========================== -->

<!-- ==================== Footer Start ==================== -->
<footer class="footer bg-color-one pt-80 pb-40">
    <div class="container container-lg">
        <div class="footer__inner">
            <div class="row gy-4">
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <div class="footer__logo mb-24">
                            <a th:href="@{/}">
                                <img th:src="@{/assets/images/logo/logo.png}" src="/assets/images/logo/logo.png" alt="MinerHive Logo">
                            </a>
                        </div>
                        <p class="text-gray-600">MinerHive - агрегатор предложений по майнинг-оборудованию. Помогаем найти выгодные предложения на рынке.</p>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <h6 class="footer__title mb-24">Быстрые ссылки</h6>
                        <ul class="footer__list">
                            <li><a th:href="@{/}" class="text-gray-600 hover-text-main-two-600">Главная</a></li>
                            <li><a th:href="@{/products}" class="text-gray-600 hover-text-main-two-600">Товары</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <h6 class="footer__title mb-24">Информация</h6>
                        <ul class="footer__list">
                            <li><a th:href="@{/about}" class="text-gray-600 hover-text-main-two-600">О нас</a></li>
                            <li><a th:href="@{/delivery}" class="text-gray-600 hover-text-main-two-600">Доставка</a></li>
                            <li><a th:href="@{/services}" class="text-gray-600 hover-text-main-two-600">Услуги</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <h6 class="footer__title mb-24">Юридическая информация</h6>
                        <ul class="footer__list">
                            <li><a th:href="@{/privacy-policy}" class="text-gray-600 hover-text-main-two-600">Политика конфиденциальности</a></li>
                            <li><a th:href="@{/cookies-policy}" class="text-gray-600 hover-text-main-two-600">Политика cookies</a></li>
                            <li><a th:href="@{/offer}" class="text-gray-600 hover-text-main-two-600">Публичная оферта</a></li>
                            <li><a th:href="@{/user-agreement}" class="text-gray-600 hover-text-main-two-600">Пользовательское соглашение</a></li>
                            <li><a th:href="@{/personal-data-consent}" class="text-gray-600 hover-text-main-two-600">Согласие на обработку данных</a></li>
                            <li><a th:href="@{/company-details}" class="text-gray-600 hover-text-main-two-600">Реквизиты компании</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 col-sm-6">
                    <div class="footer__item">
                        <h6 class="footer__title mb-24">Контакты</h6>
                        <ul class="footer__list">
                            <li class="text-gray-600">Email: ya@nismeria.com</li>
                            <li class="text-gray-600">Сайт: <a href="https://minerhive.ru" class="text-gray-600 hover-text-main-two-600" target="_blank">minerhive.ru</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- bottom Footer -->
<div class="bottom-footer bg-color-one py-8">
    <div class="container container-lg">
        <div class="bottom-footer__inner flex-between flex-wrap gap-16 py-16">
            <p class="bottom-footer__text">MinerHive &copy; 2025. Все права защищены</p>
        </div>
    </div>
</div>
<!-- ==================== Footer End ==================== -->
  

    
    <!-- jQuery js -->
    <script th:src="@{/assets/js/jquery-3.7.1.min.js}" src="assets/js/jquery-3.7.1.min.js"></script>
    <!-- Bootstrap Bundle Js -->
    <script th:src="@{/assets/js/boostrap.bundle.min.js}" src="assets/js/boostrap.bundle.min.js"></script>
    <!-- Phosphor Icons -->
    <script th:src="@{/assets/js/phosphor-icon.js}" src="assets/js/phosphor-icon.js"></script>
    <!-- Select 2 -->
    <script th:src="@{/assets/js/select2.min.js}" src="assets/js/select2.min.js"></script>
    <!-- Slick js -->
    <script th:src="@{/assets/js/slick.min.js}" src="assets/js/slick.min.js"></script>
    <!-- jQuery UI -->
    <script th:src="@{/assets/js/jquery-ui.js}" src="assets/js/jquery-ui.js"></script>
    <!-- Main js -->
    <script th:src="@{/assets/js/main.js}" src="assets/js/main.js"></script>
    
    <!-- JavaScript для переключения изображений в альбоме -->
    <script>
        // Функция для переключения основного изображения при клике на миниатюру
        function changeMainImage(thumbnailElement) {
            const mainImage = document.getElementById('mainProductImage');
            const thumbnailImg = thumbnailElement.querySelector('img');
            
            if (mainImage && thumbnailImg && thumbnailImg.src) {
                mainImage.src = thumbnailImg.src;
                
                // Обновляем активную миниатюру
                document.querySelectorAll('.product-details__thumbnails .thumbnail-item').forEach(thumb => {
                    thumb.classList.remove('active');
                });
                thumbnailElement.classList.add('active');
            }
        }
        
        // Инициализация: делаем первую миниатюру активной при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            const firstThumbnail = document.querySelector('.product-details__thumbnails .thumbnail-item');
            if (firstThumbnail) {
                firstThumbnail.classList.add('active');
            }
        });
    </script>
    
    <!-- JavaScript для сортировки и фильтрации через AJAX -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        // Глобальные переменные для состояния таблицы
        // Используем ID MinerDetail (не Product!), так как API ожидает ID MinerDetail
        const productIdRaw = /*[[${minerDetail != null ? minerDetail.id : null}]]*/ null;
        // Убеждаемся, что productId является числом
        const productId = productIdRaw != null && productIdRaw !== 0 ? Number(productIdRaw) : null;
        
        // Логируем productId для отладки
        console.log('Инициализация productId:', {
            productIdRaw: productIdRaw,
            productId: productId,
            minerDetailId: /*[[${minerDetail != null ? minerDetail.id : 'null'}]]*/ null
        });
        
        let currentDateFilter = /*[[${dateFilter != null ? dateFilter : ''}]]*/ '';
        let currentOperationType = null; // SELL, BUY или null для всех
        let currentHasPrice = null; // true для фильтра "Без пустых цен", null для всех
        let currentSortBy = /*[[${sortBy}]]*/ 'updatedAt';
        let currentSortDir = /*[[${sortDir}]]*/ 'DESC';
        let currentPage = /*[[${currentPage}]]*/ 0;
        let currentPageSize = /*[[${pageSize != null ? pageSize : 10}]]*/ 10; // По умолчанию 10 записей
        
        // Функция форматирования даты
        function formatDate(dateString) {
            if (!dateString) return '-';
            
            // Парсим дату из строки (может быть в формате ISO 8601 или массива)
            let date = null;
            try {
                if (typeof dateString === 'string') {
                    // Если строка содержит массив чисел [год, месяц, день, час, минута, секунда]
                    if (dateString.startsWith('[') || dateString.includes(',')) {
                        try {
                            const parts = JSON.parse(dateString);
                            if (Array.isArray(parts) && parts.length >= 6) {
                                // Массив: [year, month, day, hour, minute, second]
                                // Создаем дату в локальном времени (сервер уже в московском времени)
                                date = new Date(parts[0], parts[1] - 1, parts[2], parts[3], parts[4], parts[5] || 0);
                            } else {
                                date = new Date(dateString);
                            }
                        } catch (e) {
                            date = new Date(dateString);
                        }
                    } else {
                        date = new Date(dateString);
                    }
                } else if (Array.isArray(dateString)) {
                    // Если это уже массив
                    if (dateString.length >= 6) {
                        // Создаем дату в локальном времени (сервер уже в московском времени)
                        date = new Date(dateString[0], dateString[1] - 1, dateString[2], dateString[3], dateString[4], dateString[5] || 0);
                    } else {
                        return '-';
                    }
                } else {
                    date = new Date(dateString);
                }
                
                // Проверяем, что дата валидна
                if (!date || isNaN(date.getTime())) {
                    console.warn('Невалидная дата:', dateString);
                    return '-';
                }
                
                // Форматируем дату в московском времени используя toLocaleString
                const options = {
                    timeZone: 'Europe/Moscow',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                };
                
                const moscowDateStr = date.toLocaleString('ru-RU', options);
                // Формат: "23.11.2025, 15:30" -> "23.11.2025 15:30"
                return moscowDateStr.replace(',', '');
            } catch (e) {
                console.warn('Ошибка при форматировании даты:', e, dateString);
                return '-';
            }
        }
        
        // Функция загрузки предложений через AJAX
        function loadOffers() {
            // Убеждаемся, что параметры сортировки установлены
            if (!currentSortBy) {
                currentSortBy = 'updatedAt';
            }
            if (!currentSortDir) {
                currentSortDir = 'DESC';
            }
            
            // Формируем URL с учетом всех фильтров
            const params = new URLSearchParams();
            if (currentDateFilter) params.append('dateFilter', currentDateFilter);
            if (currentOperationType) params.append('operationType', currentOperationType);
            if (currentHasPrice === true) params.append('hasPrice', 'true');
            params.append('sortBy', currentSortBy);
            params.append('sortDir', currentSortDir);
            params.append('page', currentPage);
            params.append('size', currentPageSize);
            
            // Проверяем, что productId валиден
            if (!productId || productId === 0 || productId === null) {
                console.error('Неверный productId:', productId);
                const tableBody = document.getElementById('offersTableBody');
                if (tableBody) {
                    tableBody.innerHTML = '<tr><td colspan="9" class="text-center py-32 text-danger">Ошибка: Майнер не найден (ID не указан)</td></tr>';
                }
                return;
            }
            
            const url = `/api/products/${productId}/offers?${params.toString()}`;
            
            console.log('Загрузка предложений:', {
                productId: productId,
                dateFilter: currentDateFilter,
                operationType: currentOperationType,
                hasPrice: currentHasPrice,
                sortBy: currentSortBy,
                sortDir: currentSortDir,
                page: currentPage,
                size: currentPageSize,
                url: url
            });
            
            // Показываем индикатор загрузки
            const tableBody = document.getElementById('offersTableBody');
            tableBody.innerHTML = '<tr><td colspan="8" class="text-center py-32"><div class="spinner-border text-main-two-600" role="status"><span class="visually-hidden">Загрузка...</span></div></td></tr>';
            
            fetch(url)
                .then(response => {
                    // Проверяем статус ответа
                    if (!response.ok) {
                        // Если статус не OK (например, 404), пытаемся прочитать JSON, если это возможно
                        return response.json().then(data => {
                            throw new Error(data.error || `Ошибка HTTP ${response.status}: ${response.statusText}`);
                        }).catch(() => {
                            throw new Error(`Ошибка HTTP ${response.status}: ${response.statusText}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        tableBody.innerHTML = `<tr><td colspan="9" class="text-center py-32 text-danger">Ошибка: ${data.error}</td></tr>`;
                        return;
                    }
                    
                    // Обновляем таблицу
                    updateTable(data.content);
                    
                    // Обновляем информацию о количестве записей
                    updateRecordsInfo(data);
                    
                    // Обновляем пагинацию
                    updatePagination(data);
                    
                    // Обновляем иконки сортировки
                    updateSortIcons();
                    
                    // Обновляем активные кнопки фильтров
                    updateFilterButtons();
                })
                .catch(error => {
                    console.error('Ошибка при загрузке предложений:', error);
                    const errorMessage = error.message || 'Ошибка при загрузке данных';
                    tableBody.innerHTML = `<tr><td colspan="9" class="text-center py-32 text-danger">Ошибка: ${errorMessage}</td></tr>`;
                });
        }
        
        // Функция обновления таблицы
        function updateTable(offers) {
            const tableBody = document.getElementById('offersTableBody');
            
            if (!offers || offers.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" class="text-center py-32 text-gray-500">Предложений не найдено</td></tr>';
                return;
            }
            
            let html = '';
            offers.forEach(offer => {
                const operationType = offer.operationType || '';
                const operationBadge = operationType === 'SELL' ? 
                    '<span class="badge bg-success">Продажа</span>' : 
                    operationType === 'BUY' ? 
                    '<span class="badge bg-info">Покупка</span>' : 
                    '<span class="badge bg-secondary">Не указано</span>';
                
                const hashrate = offer.hashrate ? escapeHtml(offer.hashrate) : '<span class="text-gray-400">-</span>';
                const quantity = offer.quantity ? `${offer.quantity} шт.` : '-';
                const price = offer.price ? 
                    `<span class="${operationType === 'BUY' ? 'text-info' : 'text-success'} fw-bold">${offer.price}${offer.currency ? ' ' + escapeHtml(offer.currency) : ''}</span>` : 
                    '<span class="text-gray-400">-</span>';
                const condition = offer.condition ? escapeHtml(offer.condition) : '<span class="text-gray-400">-</span>';
                const location = offer.location ? escapeHtml(offer.location) : '<span class="text-gray-400">-</span>';
                const notes = offer.notes ? 
                    `<div>
                        <span class="text-muted small notes-text">${escapeHtml(offer.notes)}</span>
                        <span class="expand-toggle" onclick="toggleNotes(this)" style="display: none;">Показать больше</span>
                    </div>` : 
                    '<span class="text-gray-400">-</span>';
                // Обрабатываем дату: может быть строкой ISO 8601, массивом [year, month, day, hour, minute, second] или null
                let dateStr = '-';
                if (offer.updatedAt) {
                    try {
                        if (Array.isArray(offer.updatedAt)) {
                            // Если это массив [year, month, day, hour, minute, second, nano]
                            const parts = offer.updatedAt;
                            if (parts.length >= 6) {
                                const date = new Date(parts[0], parts[1] - 1, parts[2], parts[3], parts[4], parts[5] || 0);
                                if (!isNaN(date.getTime())) {
                                    const day = String(date.getDate()).padStart(2, '0');
                                    const month = String(date.getMonth() + 1).padStart(2, '0');
                                    const year = date.getFullYear();
                                    const hours = String(date.getHours()).padStart(2, '0');
                                    const minutes = String(date.getMinutes()).padStart(2, '0');
                                    dateStr = `${day}.${month}.${year} ${hours}:${minutes}`;
                                }
                            }
                        } else if (typeof offer.updatedAt === 'string') {
                            // Если это строка
                            dateStr = formatDate(offer.updatedAt);
                        } else {
                            // Пытаемся преобразовать в строку и парсить
                            dateStr = formatDate(String(offer.updatedAt));
                        }
                    } catch (e) {
                        console.warn('Ошибка при форматировании даты:', e, offer.updatedAt);
                        dateStr = '-';
                    }
                }
                
                html += `
                    <tr>
                        <td>${operationBadge}</td>
                        <td>${hashrate}</td>
                        <td>${quantity}</td>
                        <td>${price}</td>
                        <td>${condition}</td>
                        <td>${location}</td>
                        <td style="max-width: 200px;">
                            ${notes}
                        </td>
                        <td>${dateStr}</td>
                        <td>
                            <button type="button" 
                                    class="btn btn-sm btn-main-two" 
                                    data-offer-id="${offer.id}"
                                    onclick="openRequestModal(this.getAttribute('data-offer-id'))"
                                    style="white-space: nowrap; padding: 4px 8px; font-size: 0.75rem;">
                                <i class="ph ph-paper-plane-tilt"></i> <span>Заявка</span>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }
        
        // Функция экранирования HTML
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }
        
        // Функция обновления информации о записях
        function updateRecordsInfo(data) {
            const infoElement = document.getElementById('recordsInfo');
            if (infoElement && data) {
                const start = data.currentPage * data.pageSize + 1;
                const end = data.currentPage * data.pageSize + data.numberOfElements;
                infoElement.innerHTML = `Показано ${start} - ${end} из ${data.totalElements}`;
            }
        }
        
        // Функция обновления пагинации
        function updatePagination(data) {
            const paginationContainer = document.getElementById('paginationContainer');
            const paginationList = document.getElementById('paginationList');
            
            // Проверяем существование элементов
            if (!paginationContainer || !paginationList) {
                console.warn('Элементы пагинации не найдены на странице');
                return;
            }
            
            if (!data || data.totalPages <= 1) {
                paginationContainer.style.display = 'none';
                return;
            }
            
            paginationContainer.style.display = 'block';
            
            let html = '';
            
            // Кнопка "Предыдущая"
            html += `<li class="page-item ${data.first ? 'disabled' : ''}">
                <a class="page-link" href="#" data-page="${data.currentPage - 1}">Предыдущая</a>
            </li>`;
            
            // Номера страниц (показываем максимум 7 страниц)
            const totalPages = data.totalPages;
            const current = data.currentPage;
            let startPage = Math.max(0, current - 3);
            let endPage = Math.min(totalPages - 1, current + 3);
            
            if (startPage > 0) {
                html += `<li class="page-item"><a class="page-link" href="#" data-page="0">1</a></li>`;
                if (startPage > 1) {
                    html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<li class="page-item ${i === current ? 'active' : ''}">
                    <a class="page-link" href="#" data-page="${i}">${i + 1}</a>
                </li>`;
            }
            
            if (endPage < totalPages - 1) {
                if (endPage < totalPages - 2) {
                    html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
                html += `<li class="page-item"><a class="page-link" href="#" data-page="${totalPages - 1}">${totalPages}</a></li>`;
            }
            
            // Кнопка "Следующая"
            html += `<li class="page-item ${data.last ? 'disabled' : ''}">
                <a class="page-link" href="#" data-page="${data.currentPage + 1}">Следующая</a>
            </li>`;
            
            paginationList.innerHTML = html;
            
            // Обработчики событий уже настроены через делегирование на paginationContainer
            // Все ссылки пагинации имеют href="#", чтобы предотвратить стандартную навигацию
        }
        
        // Функция обновления иконок сортировки
        function updateSortIcons() {
            // Очищаем все иконки
            document.querySelectorAll('.offers-table .sortable .sort-icon').forEach(icon => {
                icon.innerHTML = '';
            });
            
            // Добавляем иконку к активной колонке
            const activeHeader = document.querySelector(`.offers-table .sortable[data-sort="${currentSortBy}"]`);
            if (activeHeader) {
                const icon = activeHeader.querySelector('.sort-icon');
                if (icon) {
                    const arrowDirection = currentSortDir === 'ASC' ? 'up' : 'down';
                    icon.innerHTML = `<i class="ph ph-arrow-${arrowDirection}"></i>`;
                }
            }
        }
        
        // Функция обновления активных кнопок фильтров
        function updateFilterButtons() {
            // Обновляем фильтры по дате
            document.querySelectorAll('.date-filter-btn').forEach(btn => {
                const filter = btn.getAttribute('data-filter');
                if (filter === currentDateFilter || (filter === '' && !currentDateFilter)) {
                    btn.classList.remove('btn-outline-main-two');
                    btn.classList.add('btn-main-two');
                } else {
                    btn.classList.remove('btn-main-two');
                    btn.classList.add('btn-outline-main-two');
                }
            });
            
            // Обновляем фильтры по типу операции (используем цвета сайта)
            document.querySelectorAll('.operation-filter-btn').forEach(btn => {
                const operation = btn.getAttribute('data-operation');
                if (operation === currentOperationType) {
                    // Активный фильтр - применяем заливку в цвете сайта
                    btn.classList.remove('btn-outline-main-two');
                    btn.classList.add('btn-main-two');
                } else {
                    // Неактивный фильтр - убираем заливку
                    btn.classList.remove('btn-main-two');
                    btn.classList.add('btn-outline-main-two');
                }
            });
            
            // Обновляем фильтр "Без пустых цен" (используем цвета сайта)
            document.querySelectorAll('.has-price-filter-btn').forEach(btn => {
                if (currentHasPrice === true) {
                    btn.classList.remove('btn-outline-main-two');
                    btn.classList.add('btn-main-two');
                } else {
                    btn.classList.remove('btn-main-two');
                    btn.classList.add('btn-outline-main-two');
                }
            });
        }
        
        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Обработчики для кнопок фильтров по дате
            // Используем делегирование событий для кнопок фильтров
            const filtersContainer = document.querySelector('.date-filters');
            if (filtersContainer) {
                filtersContainer.addEventListener('click', function(e) {
                    const btn = e.target.closest('.date-filter-btn');
                    if (!btn) {
                        return;
                    }
                    
                    // Предотвращаем стандартное поведение
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    const filter = btn.getAttribute('data-filter');
                    currentDateFilter = filter || ''; // Убеждаемся, что это строка
                    
                    console.log('Применение фильтра по дате:', {
                        filter: filter,
                        currentDateFilter: currentDateFilter,
                        currentSortBy: currentSortBy,
                        currentSortDir: currentSortDir
                    });
                    
                    // НЕ сбрасываем сортировку при применении фильтра
                    // Параметры сортировки сохраняются
                    currentPage = 0; // Сбрасываем только страницу на первую
                    loadOffers();
                    
                    // Предотвращаем всплытие события
                    return false;
                });
            } else {
                // Fallback для старых обработчиков, если контейнер не найден
                document.querySelectorAll('.date-filter-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        const filter = this.getAttribute('data-filter');
                        currentDateFilter = filter || '';
                        currentPage = 0;
                        loadOffers();
                        return false;
                    });
                });
            }
            
            // Обработчик для селекта размера страницы
            const pageSizeSelect = document.getElementById('pageSizeSelect');
            if (pageSizeSelect) {
                pageSizeSelect.addEventListener('change', function() {
                    currentPageSize = parseInt(this.value);
                    currentPage = 0; // Сбрасываем на первую страницу
                    loadOffers();
                });
            }
            
            // Обработчики для фильтров по типу операции (Продажа/Покупка)
            // Используем делегирование событий
            const additionalFiltersContainer = document.querySelector('.additional-filters');
            if (additionalFiltersContainer) {
                additionalFiltersContainer.addEventListener('click', function(e) {
                    // Фильтр по типу операции
                    const operationBtn = e.target.closest('.operation-filter-btn');
                    if (operationBtn) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        const operation = operationBtn.getAttribute('data-operation');
                        // Если кликнули по уже активному фильтру - снимаем фильтр
                        if (currentOperationType === operation) {
                            currentOperationType = null;
                        } else {
                            currentOperationType = operation;
                        }
                        
                        console.log('Применение фильтра по типу операции:', {
                            operation: operation,
                            currentOperationType: currentOperationType
                        });
                        
                        currentPage = 0; // Сбрасываем на первую страницу
                        loadOffers();
                        return false;
                    }
                    
                    // Фильтр "Без пустых цен"
                    const hasPriceBtn = e.target.closest('.has-price-filter-btn');
                    if (hasPriceBtn) {
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        // Переключаем фильтр: если уже активен - снимаем, иначе включаем
                        if (currentHasPrice === true) {
                            currentHasPrice = null;
                        } else {
                            currentHasPrice = true;
                        }
                        
                        console.log('Применение фильтра "Без пустых цен":', {
                            hasPrice: currentHasPrice
                        });
                        
                        currentPage = 0; // Сбрасываем на первую страницу
                        loadOffers();
                        return false;
                    }
                });
            }
            
            // Обработчики для заголовков сортировки (используем делегирование событий)
            // Обрабатываем клики на уровне таблицы, чтобы работало даже после AJAX-обновления
            const offersTable = document.getElementById('offersTable');
            if (offersTable) {
                offersTable.addEventListener('click', function(e) {
                    // Проверяем, что клик был по заголовку с классом sortable
                    const header = e.target.closest('.sortable');
                    if (!header) {
                        return; // Клик был не по заголовку сортировки
                    }
                    
                    // Предотвращаем стандартное поведение ссылки
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    const sortBy = header.getAttribute('data-sort');
                    if (!sortBy) {
                        console.warn('Не найден атрибут data-sort у заголовка таблицы');
                        return;
                    }
                    
                    console.log('Клик по заголовку сортировки:', {
                        sortBy: sortBy,
                        currentSortBy: currentSortBy,
                        currentSortDir: currentSortDir,
                        currentDateFilter: currentDateFilter
                    });
                    
                    // Определяем новое направление сортировки
                    if (sortBy === currentSortBy) {
                        currentSortDir = currentSortDir === 'ASC' ? 'DESC' : 'ASC';
                    } else {
                        currentSortBy = sortBy;
                        currentSortDir = 'DESC';
                    }
                    
                    console.log('Новые параметры сортировки:', {
                        currentSortBy: currentSortBy,
                        currentSortDir: currentSortDir,
                        currentDateFilter: currentDateFilter
                    });
                    
                    currentPage = 0; // Сбрасываем на первую страницу
                    loadOffers();
                    
                    // Предотвращаем всплытие события
                    return false;
                });
            }
            
            // Инициализация пагинации при первой загрузке (используем делегирование событий)
            const paginationContainer = document.getElementById('paginationContainer');
            const paginationList = document.getElementById('paginationList');
            
            if (paginationContainer) {
                // Используем делегирование событий для обработки кликов по пагинации
                // Это работает даже после AJAX-обновления таблицы
                paginationContainer.addEventListener('click', function(e) {
                    const link = e.target.closest('a.page-link[data-page]');
                    if (!link) {
                        return;
                    }
                    
                    // Предотвращаем стандартное поведение ссылки
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    const pageItem = link.closest('.page-item');
                    if (pageItem && !pageItem.classList.contains('disabled')) {
                        const page = parseInt(link.getAttribute('data-page'));
                        if (!isNaN(page) && page >= 0) {
                            currentPage = page;
                            loadOffers();
                        }
                    }
                    
                    // Предотвращаем всплытие события
                    return false;
                });
                
                // Показываем пагинацию, если она есть
                if (paginationList && paginationList.querySelectorAll('.page-link[data-page]').length > 0) {
                    paginationContainer.style.display = 'block';
                }
            }
            
            // Обновляем иконки сортировки при первой загрузке (на основе серверных данных)
            updateSortIcons();
            
            // Обновляем состояние кнопок фильтров при первой загрузке
            updateFilterButtons();
        });
        
        // Функция открытия модального окна заявки для Offer
        function openRequestModal(offerId) {
            const modalElement = document.getElementById('requestModal');
            if (!modalElement) {
                console.error('Модальное окно requestModal не найдено');
                return;
            }
            const modal = new bootstrap.Modal(modalElement);
            document.getElementById('requestOfferId').value = offerId;
            document.getElementById('requestCompanyMinerId').value = '';
            document.getElementById('requestForm').reset();
            document.getElementById('requestOfferId').value = offerId; // Восстанавливаем после reset
            modal.show();
        }
        
        // Функция открытия модального окна заявки для CompanyMiner
        function openCompanyMinerRequestModal(companyMinerId) {
            const modalElement = document.getElementById('requestModal');
            if (!modalElement) {
                console.error('Модальное окно requestModal не найдено');
                return;
            }
            const modal = new bootstrap.Modal(modalElement);
            document.getElementById('requestOfferId').value = '';
            document.getElementById('requestCompanyMinerId').value = companyMinerId;
            document.getElementById('requestForm').reset();
            document.getElementById('requestCompanyMinerId').value = companyMinerId; // Восстанавливаем после reset
            modal.show();
        }
        
        // Обработчик отправки формы заявки
        document.addEventListener('DOMContentLoaded', function() {
            const requestForm = document.getElementById('requestForm');
            if (requestForm) {
                requestForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const offerId = document.getElementById('requestOfferId').value;
                    const companyMinerId = document.getElementById('requestCompanyMinerId').value;
                    const clientName = document.getElementById('clientName').value.trim();
                    const clientPhone = document.getElementById('clientPhone').value.trim();
                    const message = document.getElementById('requestMessage').value.trim();
                    
                    // Валидация
                    if (!offerId && !companyMinerId) {
                        alert('Ошибка: не указан ID предложения или майнера компании');
                        return;
                    }
                    
                    if (offerId && companyMinerId) {
                        alert('Ошибка: указаны оба ID. Укажите только один.');
                        return;
                    }
                    
                    if (!clientName) {
                        alert('Пожалуйста, укажите ваше имя');
                        return;
                    }
                    
                    if (!clientPhone) {
                        alert('Пожалуйста, укажите ваш телефон');
                        return;
                    }
                    
                    // Отправка заявки
                    const submitBtn = document.getElementById('submitRequestBtn');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Отправка...';
                    
                    // Формируем тело запроса
                    const requestBody = {
                        clientName: clientName,
                        clientPhone: clientPhone,
                        message: message || null
                    };
                    
                    if (offerId) {
                        requestBody.offerId = parseInt(offerId);
                    } else {
                        requestBody.companyMinerId = parseInt(companyMinerId);
                    }
                    
                    fetch('/requests/api/create', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json;charset=UTF-8',
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        body: JSON.stringify(requestBody)
                    })
                    .then(response => {
                        // Проверяем статус ответа
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        // Проверяем Content-Type заголовок
                        const contentType = response.headers.get('content-type');
                        if (!contentType || !contentType.includes('application/json')) {
                            return response.text().then(text => {
                                console.error('Ожидался JSON, но получен:', contentType || 'неизвестный тип');
                                console.error('Первые 500 символов ответа:', text.substring(0, 500));
                                throw new Error('Сервер вернул не JSON. Возможно, произошла ошибка на сервере.');
                            });
                        }
                        
                        return response.json();
                    })
                    .then(data => {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                        
                        if (data.error) {
                            alert('Ошибка: ' + data.error);
                        } else if (data.success) {
                            alert('Заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.');
                            const modalElement = document.getElementById('requestModal');
                            const modal = bootstrap.Modal.getInstance(modalElement);
                            if (modal) {
                                modal.hide();
                            }
                            document.getElementById('requestForm').reset();
                        } else {
                            alert('Заявка успешно отправлена! Мы свяжемся с вами в ближайшее время.');
                            const modalElement = document.getElementById('requestModal');
                            const modal = bootstrap.Modal.getInstance(modalElement);
                            if (modal) {
                                modal.hide();
                            }
                            document.getElementById('requestForm').reset();
                        }
                    })
                    .catch(error => {
                        console.error('Ошибка при отправке заявки:', error);
                        console.error('Сообщение об ошибке:', error.message);
                        console.error('Стек ошибки:', error.stack);
                        
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                        
                        const errorMessage = error.message || 'Произошла ошибка при отправке заявки. Попробуйте еще раз.';
                        alert('Ошибка: ' + errorMessage);
                    });
                });
            }
        });
        /*]]>*/
        // Функция для раскрытия/сворачивания примечаний
        function toggleNotes(toggleElement) {
            const notesText = toggleElement.previousElementSibling;
            if (notesText && notesText.classList.contains('notes-text')) {
                if (notesText.classList.contains('expanded')) {
                    notesText.classList.remove('expanded');
                    toggleElement.textContent = 'Показать больше';
                } else {
                    notesText.classList.add('expanded');
                    toggleElement.textContent = 'Свернуть';
                }
            }
        }
        
        // Проверяем, нужно ли показывать кнопку "Показать больше" для примечаний
        function checkNotesOverflow() {
            document.querySelectorAll('.notes-text').forEach(notesSpan => {
                const parentDiv = notesSpan.parentElement;
                if (parentDiv) {
                    const toggleBtn = parentDiv.querySelector('.expand-toggle');
                    if (toggleBtn) {
                        // Временно убираем ограничение по высоте для проверки
                        const wasExpanded = notesSpan.classList.contains('expanded');
                        if (!wasExpanded) {
                            notesSpan.style.maxHeight = 'none';
                            const fullHeight = notesSpan.scrollHeight;
                            notesSpan.style.maxHeight = '';
                            
                            // Проверяем, превышает ли высота контента максимальную высоту
                            const maxHeight = parseFloat(window.getComputedStyle(notesSpan).maxHeight);
                            if (fullHeight > maxHeight) {
                                toggleBtn.style.display = 'inline-block';
                            } else {
                                toggleBtn.style.display = 'none';
                            }
                        } else {
                            toggleBtn.style.display = 'inline-block';
                            toggleBtn.textContent = 'Свернуть';
                        }
                    }
                }
            });
        }
        
        // Проверяем примечания после загрузки таблицы
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkNotesOverflow, 100);
        });
        
        // Перехватываем функцию updateTable для проверки примечаний после обновления
        if (typeof updateTable !== 'undefined') {
            const originalUpdateTable = updateTable;
            window.updateTable = function(offers) {
                originalUpdateTable(offers);
                setTimeout(checkNotesOverflow, 150);
            };
        }
    </script>

    <!-- Модальное окно для отправки заявки -->
    <div class="modal fade" id="requestModal" tabindex="-1" aria-labelledby="requestModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="requestModalLabel">
                        <i class="ph ph-paper-plane-tilt"></i> Отправить заявку
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="requestForm">
                    <div class="modal-body">
                        <input type="hidden" id="requestOfferId" name="offerId">
                        <input type="hidden" id="requestCompanyMinerId" name="companyMinerId">
                        
                        <div class="mb-24">
                            <label for="clientName" class="form-label fw-semibold">
                                Ваше имя <span class="text-danger">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="clientName" 
                                   name="clientName" 
                                   required 
                                   placeholder="Введите ваше имя">
                        </div>
                        
                        <div class="mb-24">
                            <label for="clientPhone" class="form-label fw-semibold">
                                Телефон <span class="text-danger">*</span>
                            </label>
                            <input type="tel" 
                                   class="form-control" 
                                   id="clientPhone" 
                                   name="clientPhone" 
                                   required 
                                   placeholder="+7 (XXX) XXX-XX-XX">
                        </div>
                        
                        <div class="mb-24">
                            <label for="requestMessage" class="form-label fw-semibold">
                                Сообщение (необязательно)
                            </label>
                            <textarea class="form-control" 
                                      id="requestMessage" 
                                      name="message" 
                                      rows="4" 
                                      placeholder="Укажите дополнительные детали, если необходимо"></textarea>
                        </div>
                        
                        <div class="alert alert-info mb-0">
                            <i class="ph ph-info"></i> 
                            <small>Мы свяжемся с вами в ближайшее время для уточнения деталей.</small>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Отмена</button>
                        <button type="submit" class="btn btn-main-two" id="submitRequestBtn">
                            <i class="ph ph-paper-plane-tilt"></i> Отправить заявку
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105468809', 'ym');

        ym(105468809, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/105468809" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <!-- Cookie Consent Banner -->
    <th:block th:replace="~{fragments/cookie-consent :: cookie-consent-banner}"></th:block>

    </body>
</html>


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ru" dir="ltr" data-nav-layout="vertical" data-theme-mode="light" data-header-styles="light" data-menu-styles="light" data-toggled="close">

<head>
    <!-- Meta Data -->
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Приватная панель - MinerHive</title>
    <meta name="Description" content="Панель управления интернет-магазином MinerHive">
    
    <!-- Favicon -->
    <th:block th:replace="~{fragments/favicon :: favicon-tags}"></th:block>
    
    <!-- Choices JS -->
    <script th:src="@{/bootstrap-theme/assets/libs/choices.js/public/assets/scripts/choices.min.js}" src="../assets/libs/choices.js/public/assets/scripts/choices.min.js"></script>
    
    <!-- Bootstrap Css -->
    <link id="style" th:href="@{/bootstrap-theme/assets/libs/bootstrap/css/bootstrap.min.css}" href="../assets/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Style Css -->
    <link th:href="@{/bootstrap-theme/assets/css/styles.min.css}" href="../assets/css/styles.min.css" rel="stylesheet">

    <!-- Icons Css -->
    <link th:href="@{/bootstrap-theme/assets/css/icons.css}" href="../assets/css/icons.css" rel="stylesheet">

    <!-- Node Waves Css -->
    <link th:href="@{/bootstrap-theme/assets/libs/node-waves/waves.min.css}" href="../assets/libs/node-waves/waves.min.css" rel="stylesheet"> 

    <!-- Simplebar Css -->
    <link th:href="@{/bootstrap-theme/assets/libs/simplebar/simplebar.min.css}" href="../assets/libs/simplebar/simplebar.min.css" rel="stylesheet">
    
    <!-- Color Picker Css -->
    <link rel="stylesheet" th:href="@{/bootstrap-theme/assets/libs/flatpickr/flatpickr.min.css}" href="../assets/libs/flatpickr/flatpickr.min.css">
    <link rel="stylesheet" th:href="@{/bootstrap-theme/assets/libs/@simonwep/pickr/themes/nano.min.css}" href="../assets/libs/@simonwep/pickr/themes/nano.min.css">

    <!-- Choices Css -->
    <link rel="stylesheet" th:href="@{/bootstrap-theme/assets/libs/choices.js/public/assets/styles/choices.min.css}" href="../assets/libs/choices.js/public/assets/styles/choices.min.css">
    
    <!-- Fix for missing DOM elements and modal backdrop cleanup - MUST be before other scripts -->
    <script>
        // Global error handler to prevent script errors from breaking the page
        window.addEventListener('error', function(e) {
            // Suppress errors from defaultmenu.min.js, custom-switcher.min.js, custom.js if they're about missing elements
            const errorMessage = e.message || '';
            const errorFilename = e.filename || '';
            
            if (errorMessage.includes('Cannot read properties of null') ||
                errorMessage.includes('classList') ||
                errorMessage.includes('addEventListener') ||
                errorMessage.includes('appendChild') ||
                errorFilename.includes('defaultmenu.min.js') ||
                errorFilename.includes('custom-switcher.min.js') ||
                errorFilename.includes('custom.js')) {
                // Suppress the error silently (don't try to create elements here to avoid recursion)
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return true;
            }
        }, true);
        
        // Also catch unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            const reason = e.reason || '';
            if (typeof reason === 'string' && (
                reason.includes('Cannot read properties of null') ||
                reason.includes('classList') ||
                reason.includes('addEventListener') ||
                reason.includes('appendChild')
            )) {
                // Suppress the error silently
                e.preventDefault();
                return true;
            }
        });
        
        // Ensure all required DOM elements exist before scripts execute
        (function() {
            let isEnsuring = false; // Flag to prevent recursion
            
            // Make ensureElements globally available
            window.ensureElements = function ensureElements() {
                // Prevent recursion
                if (isEnsuring) {
                    return;
                }
                isEnsuring = true;
                
                try {
                    // Remove any leftover modal backdrops from previous sessions
                    try {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => backdrop.remove());
                    } catch (e) {}
                    
                    // Remove modal-open class from body
                    if (document.body) {
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                    }
                    
                    // Use getElementsByClassName and getElementById to avoid querySelector recursion
                    const headerContentLefts = document.getElementsByClassName('header-content-left');
                    let headerContentLeft = headerContentLefts.length > 0 ? headerContentLefts[0] : null;
                    
                    if (!headerContentLeft && document.body) {
                        const headerContainers = document.getElementsByClassName('main-header-container');
                        if (headerContainers.length > 0) {
                            const headerContainer = headerContainers[0];
                            headerContentLeft = document.createElement('div');
                            headerContentLeft.className = 'header-content-left';
                            headerContainer.insertBefore(headerContentLeft, headerContainer.firstChild);
                        }
                    }
                    
                    // Ensure horizontal menu exists
                    const horizontalMenus = document.getElementsByClassName('horizontal-menu');
                    let horizontalMenu = horizontalMenus.length > 0 ? horizontalMenus[0] : null;
                    
                    if (!horizontalMenu) {
                        const headerCenters = document.getElementsByClassName('main-header-center');
                        let headerCenter = headerCenters.length > 0 ? headerCenters[0] : null;
                        
                        if (!headerCenter && headerContentLeft) {
                            const headerElements = headerContentLeft.getElementsByClassName('header-element');
                            let headerElement = headerElements.length > 0 ? headerElements[0] : null;
                            
                            if (!headerElement) {
                                headerElement = document.createElement('div');
                                headerElement.className = 'header-element';
                                headerContentLeft.appendChild(headerElement);
                            }
                            
                            headerCenter = document.createElement('div');
                            headerCenter.className = 'main-header-center d-none d-lg-block';
                            headerCenter.style.display = 'none';
                            headerElement.appendChild(headerCenter);
                        }
                        
                        if (headerCenter) {
                            horizontalMenu = document.createElement('nav');
                            horizontalMenu.className = 'horizontal-menu';
                            const ul = document.createElement('ul');
                            ul.className = 'horizontal-list';
                            horizontalMenu.appendChild(ul);
                            horizontalMenu.style.display = 'none';
                            headerCenter.appendChild(horizontalMenu);
                        }
                    } else {
                        // Ensure horizontal-menu has required structure
                        const uls = horizontalMenu.getElementsByTagName('ul');
                        if (uls.length === 0) {
                            const ul = document.createElement('ul');
                            ul.className = 'horizontal-list';
                            horizontalMenu.appendChild(ul);
                        }
                    }
                    
                    // Ensure switcher-icon exists
                    const switcherIcons = document.getElementsByClassName('switcher-icon');
                    let switcherIcon = switcherIcons.length > 0 ? switcherIcons[0] : null;
                    
                    if (!switcherIcon) {
                        const headerContentRights = document.getElementsByClassName('header-content-right');
                        if (headerContentRights.length > 0) {
                            const headerContentRight = headerContentRights[0];
                            switcherIcon = document.createElement('a');
                            switcherIcon.href = 'javascript:void(0);';
                            switcherIcon.className = 'header-link switcher-icon';
                            switcherIcon.setAttribute('data-bs-toggle', 'offcanvas');
                            switcherIcon.setAttribute('data-bs-target', '#switcher-canvas');
                            switcherIcon.style.display = 'none';
                            const headerElements = headerContentRight.getElementsByClassName('header-element');
                            const headerElement = headerElements.length > 0 ? headerElements[0] : null;
                            if (headerElement) {
                                headerElement.appendChild(switcherIcon);
                            } else {
                                headerContentRight.appendChild(switcherIcon);
                            }
                        }
                    }
                
                    // Ensure loader element exists
                    let loader = document.getElementById('loader');
                    if (!loader) {
                        loader = document.createElement('div');
                        loader.id = 'loader';
                        loader.style.display = 'none';
                        loader.innerHTML = '<div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>';
                        if (document.body) {
                            document.body.insertBefore(loader, document.body.firstChild);
                        }
                    }
                    
                    // Ensure switcher-canvas exists and has required structure
                    let switcherCanvas = document.getElementById('switcher-canvas');
                    if (!switcherCanvas) {
                        switcherCanvas = document.createElement('div');
                        switcherCanvas.className = 'offcanvas offcanvas-end';
                        switcherCanvas.id = 'switcher-canvas';
                        switcherCanvas.setAttribute('tabindex', '-1');
                        switcherCanvas.setAttribute('aria-labelledby', 'offcanvasRightLabel');
                        switcherCanvas.innerHTML = '<div class="offcanvas-header"><h5 id="offcanvasRightLabel">Switcher</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button></div><div class="offcanvas-body"></div>';
                        switcherCanvas.style.display = 'none';
                        if (document.body) {
                            document.body.appendChild(switcherCanvas);
                        }
                    }
                    
                    // Ensure header-sidebar exists
                    let headerSidebar = document.getElementById('header-sidebar');
                    if (!headerSidebar) {
                        headerSidebar = document.createElement('div');
                        headerSidebar.className = 'offcanvas offcanvas-end';
                        headerSidebar.id = 'header-sidebar';
                        headerSidebar.setAttribute('tabindex', '-1');
                        headerSidebar.setAttribute('aria-labelledby', 'sidebarLabel');
                        headerSidebar.innerHTML = '<div class="offcanvas-header"><h5 id="sidebarLabel">Меню</h5><button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button></div><div class="offcanvas-body"></div>';
                        headerSidebar.style.display = 'none';
                        if (document.body) {
                            document.body.appendChild(headerSidebar);
                        }
                    }
                    
                    // Ensure scrollToTop element exists (custom.js might need it)
                    const scrollToTops = document.getElementsByClassName('scrollToTop');
                    let scrollToTop = scrollToTops.length > 0 ? scrollToTops[0] : null;
                    if (!scrollToTop) {
                        scrollToTop = document.createElement('div');
                        scrollToTop.className = 'scrollToTop';
                        scrollToTop.style.display = 'none';
                        if (document.body) {
                            document.body.appendChild(scrollToTop);
                        }
                    }
                } finally {
                    isEnsuring = false;
                }
            };
            
            // Run immediately
            window.ensureElements();
            
            // Run when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', window.ensureElements);
            } else {
                // DOM already loaded
                window.ensureElements();
            }
            
            // Also run after a short delay to catch any late-loading elements
            setTimeout(function() { isEnsuring = false; window.ensureElements(); }, 10);
            setTimeout(function() { isEnsuring = false; window.ensureElements(); }, 100);
        })();
    </script>
    
    <!-- Стили для восстановления прокрутки страницы -->
    <style>
        /* Восстановление прокрутки страницы */
        html, body {
            overflow-x: hidden !important;
            overflow-y: auto !important;
        }
    </style>
</head> 

<body>
    <!-- Page Loader -->
    <div id="loader">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    <!-- Page Loader -->

    <!-- Start Switcher -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="switcher-canvas" aria-labelledby="offcanvasRightLabel" aria-hidden="true">
        <div class="offcanvas-header border-bottom">
            <h5 class="offcanvas-title text-default" id="offcanvasRightLabel">Switcher</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <nav class="border-bottom border-block-end-dashed">
                <div class="nav nav-tabs nav-justified" id="switcher-main-tab" role="tablist">
                    <button class="nav-link active" id="switcher-home-tab" data-bs-toggle="tab" data-bs-target="#switcher-home"
                        type="button" role="tab" aria-controls="switcher-home" aria-selected="true">Theme Styles</button>
                    <button class="nav-link" id="switcher-profile-tab" data-bs-toggle="tab" data-bs-target="#switcher-profile"
                        type="button" role="tab" aria-controls="switcher-profile" aria-selected="false">Theme Colors</button>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active border-0" id="switcher-home" role="tabpanel" aria-labelledby="switcher-home-tab" tabindex="0">
                    <div class="">
                        <p class="switcher-style-head">Theme Color Mode:</p>
                        <div class="row switcher-style gx-0">
                            <div class="col-4">
                                <div class="form-check switch-select">
                                    <label class="form-check-label" for="switcher-light-theme">Light</label>
                                    <input class="form-check-input" type="radio" name="theme-style" id="switcher-light-theme" checked>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-check switch-select">
                                    <label class="form-check-label" for="switcher-dark-theme">Dark</label>
                                    <input class="form-check-input" type="radio" name="theme-style" id="switcher-dark-theme">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade border-0" id="switcher-profile" role="tabpanel" aria-labelledby="switcher-profile-tab" tabindex="0">
                        <div class="">
                            <p class="switcher-style-head">Menu Colors:</p>
                            <div class="d-flex switcher-style pb-2">
                                <div class="form-check switch-select me-2">
                                    <input class="form-check-input" type="radio" name="menu-colors" id="switcher-menu-light" checked>
                                    <label class="form-check-label" for="switcher-menu-light">Light</label>
                                </div>
                                <div class="form-check switch-select me-2">
                                    <input class="form-check-input" type="radio" name="menu-colors" id="switcher-menu-dark">
                                    <label class="form-check-label" for="switcher-menu-dark">Dark</label>
                                </div>
                                <div class="form-check switch-select">
                                    <input class="form-check-input" type="radio" name="menu-colors" id="switcher-menu-primary">
                                    <label class="form-check-label" for="switcher-menu-primary">Primary</label>
                                </div>
                            </div>
                        </div>
                        <div class="">
                            <p class="switcher-style-head">Header Colors:</p>
                            <div class="d-flex switcher-style pb-2">
                                <div class="form-check switch-select me-2">
                                    <input class="form-check-input" type="radio" name="header-colors" id="switcher-header-light" checked>
                                    <label class="form-check-label" for="switcher-header-light">Light</label>
                                </div>
                                <div class="form-check switch-select me-2">
                                    <input class="form-check-input" type="radio" name="header-colors" id="switcher-header-dark">
                                    <label class="form-check-label" for="switcher-header-dark">Dark</label>
                                </div>
                            </div>
  </div>
</div>
            </div>
        </div>
    </div>
    <!-- End Switcher -->

    <!-- Start::Off-canvas sidebar-->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="header-sidebar" aria-labelledby="sidebarLabel" aria-hidden="true">
        <div class="offcanvas-header rounded-0">
            <h5 class="fs-14 text-uppercase mb-0 fw-semibold" id="sidebarLabel">Меню</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body rounded-0 p-0">
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><a th:href="@{/private}" class="text-dark">Панель управления</a></li>
                <li class="list-group-item" sec:authorize="hasRole('ADMIN')"><a th:href="@{/private/messages}" class="text-dark">Сообщения</a></li>
                <li class="list-group-item" sec:authorize="hasRole('ADMIN')"><a th:href="@{/private/products/table}" class="text-dark">Таблица товаров</a></li>
                <li class="list-group-item" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')"><a th:href="@{/private/offers}" class="text-dark">Предложения</a></li>
                <li class="list-group-item"><a th:href="@{/private/requests}" class="text-dark">Заявки</a></li>
                <li class="list-group-item"><a th:href="@{/private/miner-details}" class="text-dark">Детали майнеров</a></li>
                <li class="list-group-item"><a th:href="@{/private/company-miners}" class="text-dark">Майнеры компании</a></li>
                <li class="list-group-item"><a th:href="@{/private/profitability}" class="text-dark">Калькулятор доходности</a></li>
                <li class="list-group-item" sec:authorize="hasRole('ADMIN')"><a th:href="@{/private/users}" class="text-dark">Пользователи</a></li>
            </ul>
        </div>
    </div>
    <!-- End::Off-canvas sidebar-->

    <div class="page">
        <!-- app-header -->
        <header class="app-header">
            <!-- Start::main-header-container -->
            <div class="main-header-container container-fluid">
                <!-- Start::header-content-left -->
                <div class="header-content-left">
                    <!-- Start::header-element -->
                    <div class="header-element">
                        <div class="horizontal-logo">
                            <a th:href="@{/}" class="header-logo">
                                <img th:src="@{/bootstrap-theme/assets/images/brand-logos/desktop-logo.png}" src="../assets/images/brand-logos/desktop-logo.png" alt="logo" class="desktop-logo">
                                <img th:src="@{/bootstrap-theme/assets/images/brand-logos/toggle-logo.png}" src="../assets/images/brand-logos/toggle-logo.png" alt="logo" class="toggle-logo">
                                <img th:src="@{/bootstrap-theme/assets/images/brand-logos/desktop-white.png}" src="../assets/images/brand-logos/desktop-white.png" alt="logo" class="desktop-white">
                                <img th:src="@{/bootstrap-theme/assets/images/brand-logos/toggle-white.png}" src="../assets/images/brand-logos/toggle-white.png" alt="logo" class="toggle-white">
                            </a>
                        </div>
                    </div>
                    <!-- End::header-element -->

                    <!-- Start::header-element -->
                    <div class="header-element">
                        <!-- Start::header-link -->
                        <a aria-label="Hide Sidebar" class="sidemenu-toggle header-link animated-arrow hor-toggle horizontal-navtoggle" data-bs-toggle="sidebar" href="javascript:void(0);">
                            <i class="header-icon fe fe-align-left"></i>
                        </a>
                        <!-- End::header-link -->
                        <!-- Horizontal Menu Container (hidden, but needed for scripts) -->
                        <div class="main-header-center d-none d-lg-block" style="display: none !important;">
                            <nav class="horizontal-menu"></nav>
                        </div>
                    </div>
                    <!-- End::header-element -->
</div>
                <!-- End::header-content-left -->

                <!-- Start::header-content-right -->
                <div class="header-content-right">
                    <!-- Start::header-element -->
                    <div class="header-element header-sidebar">
                        <!-- Start::header-link-->
                        <a href="javascript:void(0);" class="header-link" data-bs-toggle="offcanvas" data-bs-target="#header-sidebar">
                            <svg xmlns="http://www.w3.org/2000/svg" class="header-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                        </a>
                        <!-- End::header-link-->
        </div>
                    <!-- End::header-element -->

                    <!-- Start::header-element -->
                    <div class="header-element">
                        <!-- Start::header-link|switcher-icon -->
                        <a href="javascript:void(0);" class="header-link switcher-icon" data-bs-toggle="offcanvas" data-bs-target="#switcher-canvas">
                            <svg xmlns="http://www.w3.org/2000/svg" class="header-link-icon" width="24" height="24" viewBox="0 0 24 24"><path d="M12 16c2.206 0 4-1.794 4-4s-1.794-4-4-4-4 1.794-4 4 1.794 4 4 4zm0-6c1.084 0 2 .916 2 2s-.916 2-2 2-2-.916-2-2 .916-2 2-2z"></path><path d="m2.845 16.136 1 1.73c.531.917 1.809 1.261 2.73.73l.529-.306A8.1 8.1 0 0 0 9 19.402V20c0 1.103.897 2 2 2h2c1.103 0 2-.897 2-2v-.598a8.132 8.132 0 0 0 1.896-1.111l.529.306c.923.53 2.198.188 2.731-.731l.999-1.729a2.001 2.001 0 0 0-.731-2.732l-.505-.292a7.718 7.718 0 0 0 0-2.224l.505-.292a2.002 2.002 0 0 0 .731-2.732l-.999-1.729c-.531-.92-1.808-1.265-2.731-.732l-.529.306A8.1 8.1 0 0 0 15 4.598V4c0-1.103-.897-2-2-2h-2c-1.103 0-2 .897-2 2v.598a8.132 8.132 0 0 0-1.896 1.111l-.529-.306c-.924-.531-2.2-.187-2.731.732l-.999 1.729a2.001 2.001 0 0 0 .731 2.732l.505.292a7.683 7.683 0 0 0 0 2.223l-.505.292a2.003 2.003 0 0 0-.731 2.733zm3.326-2.758A5.703 5.703 0 0 1 6 12c0-.462.058-.926.17-1.378a.999.999 0 0 0-.47-1.108l-1.123-.65.998-1.729 1.145.662a.997.997 0 0 0 1.188-.142 6.071 6.071 0 0 1 2.384-1.399A1 1 0 0 0 11 5.3V4h2v1.3a1 1 0 0 0 .708.956 6.083 6.083 0 0 1 2.384 1.399.999.999 0 0 0 1.188.142l1.144-.661 1 1.729-1.124.649a1 1 0 0 0-.47 1.108c.112.452.17.916.17 1.378 0 .461-.058.925-.171 1.378a1 1 0 0 0 .471 1.108l1.123.649-.998 1.729-1.145-.661a.996.996 0 0 0-1.188.142 6.071 6.071 0 0 1-2.384 1.399A1 1 0 0 0 13 18.7l.002 1.3H11v-1.3a1 1 0 0 0-.708-.956 6.083 6.083 0 0 1-2.384-1.399.992.992 0 0 0-1.188-.141l-1.144.662-1-1.729 1.124-.651a1 1 0 0 0 .471-1.108z"></path></svg>
                        </a>
                        <!-- End::header-link|switcher-icon -->
                    </div>
                    <!-- End::header-element -->

                    <!-- Start::header-element -->
                    <div class="header-element headerProfile-dropdown">
                        <!-- Start::header-link|dropdown-toggle -->
                        <a href="javascript:void(0);" class="header-link dropdown-toggle" id="mainHeaderProfile" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                            <i class="fe fe-user fs-20"></i>
                        </a>
                        <!-- End::header-link|dropdown-toggle -->
                        <ul class="main-header-dropdown dropdown-menu pt-0 header-profile-dropdown dropdown-menu-end main-profile-menu" aria-labelledby="mainHeaderProfile">
                            <li>
                                <div class="main-header-profile bg-primary menu-header-content text-fixed-white">
                                    <div class="my-auto">
                                        <h6 class="mb-0 lh-1 text-fixed-white">
                                            <span sec:authorize="hasRole('ADMIN')">Администратор</span>
                                            <span sec:authorize="hasRole('MANAGER') and !hasRole('ADMIN')">Менеджер</span>
                                        </h6>
                                        <span class="fs-11 op-7 lh-1">MinerHive</span>
                                    </div>
                                </div>
                            </li>
                            <li><a class="dropdown-item d-flex" th:href="@{/}"><i class="bx bx-home fs-18 me-2 op-7"></i>Главная</a></li>
                            <li><a class="dropdown-item d-flex border-block-end" th:href="@{/logout}"><i class="bx bx-log-out fs-18 me-2 op-7"></i>Выход</a></li>
                        </ul>
                    </div>  
                    <!-- End::header-element -->
                </div>
                <!-- End::header-content-right -->
            </div>
            <!-- End::main-header-container -->
        </header>
        <!-- /app-header -->

        <!-- Start::app-sidebar -->
        <aside class="app-sidebar sticky" id="sidebar">
            <!-- Start::main-sidebar-header -->
            <div class="main-sidebar-header">
                <a th:href="@{/}" class="header-logo">
                    <img th:src="@{/bootstrap-theme/assets/images/brand-logos/desktop-logo.png}" src="../assets/images/brand-logos/desktop-logo.png" alt="logo" class="desktop-logo">
                    <img th:src="@{/bootstrap-theme/assets/images/brand-logos/toggle-logo.png}" src="../assets/images/brand-logos/toggle-logo.png" alt="logo" class="toggle-logo">
                    <img th:src="@{/bootstrap-theme/assets/images/brand-logos/desktop-white.png}" src="../assets/images/brand-logos/desktop-white.png" alt="logo" class="desktop-white">
                    <img th:src="@{/bootstrap-theme/assets/images/brand-logos/toggle-white.png}" src="../assets/images/brand-logos/toggle-white.png" alt="logo" class="toggle-white">
                </a>
            </div>
            <!-- End::main-sidebar-header -->

            <!-- Start::main-sidebar -->
            <div class="main-sidebar" id="sidebar-scroll">
                <!-- Start::nav -->
                <nav class="main-menu-container nav nav-pills flex-column sub-open">
                    <div class="slide-left" id="slide-left">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="#7b8191" width="24" height="24" viewBox="0 0 24 24"> <path d="M13.293 6.293 7.586 12l5.707 5.707 1.414-1.414L10.414 12l4.293-4.293z"></path> </svg>
                    </div>
                    <ul class="main-menu">
                        <!-- Start::slide__category -->
                        <li class="slide__category"><span class="category-name">Главное</span></li>
                        <!-- End::slide__category -->

                        <!-- Start::slide -->
                        <li class="slide">
                            <a th:href="@{/private}" class="side-menu__item active">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M5 5h4v6H5zm10 8h4v6h-4zM5 17h4v2H5zM15 5h4v2h-4z" opacity=".3"/><path d="M3 13h8V3H3v10zm2-8h4v6H5V5zm8 16h8V11h-8v10zm2-8h4v6h-4v-6zM13 3v6h8V3h-8zm6 4h-4V5h4v2zM3 21h8v-6H3v6zm2-4h4v2H5v-2z"/></svg>
                                <span class="side-menu__label">Панель управления</span>
                            </a>
                        </li>
                        <!-- End::slide -->

                        <!-- Start::slide__category -->
                        <li class="slide__category"><span class="category-name">Управление</span></li>
                        <!-- End::slide__category -->

                        <!-- Start::slide -->
                        <li class="slide" sec:authorize="hasRole('ADMIN')">
                            <a th:href="@{/private/messages}" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                                <span class="side-menu__label">Сообщения</span>
                            </a>
                        </li>
                        <!-- End::slide -->

                        <!-- Start::slide -->
                        <li class="slide" sec:authorize="hasRole('ADMIN')">
                            <a th:href="@{/private/products/table}" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 5H5v14h14V5zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" opacity=".3"/><path d="M3 5v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2zm2 0h14v14H5V5zm2 5h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/></svg>
                                <span class="side-menu__label">Таблица товаров</span>
                            </a>
                        </li>
                        <!-- End::slide -->

                        <!-- Start::slide -->
                        <li class="slide" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')">
                            <a th:href="@{/private/offers}" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24">
                                    <path d="M0 0h24v24H0V0z" fill="none"/>
                                    <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
                                </svg>
                                <span class="side-menu__label">Предложения</span>
                            </a>
                        </li>
                        <!-- End::slide -->

                        <!-- Start::slide -->
                        <li class="slide">
                            <a th:href="@{/private/requests}" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
                                <span class="side-menu__label">Заявки</span>
                            </a>
                        </li>
                        <!-- End::slide -->

                        <!-- Start::slide -->
                        <li class="slide">
                            <a th:href="@{/private/miner-details}" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                                <span class="side-menu__label">Детали майнеров</span>
                            </a>
                        </li>
                        <!-- End::slide -->

                        <!-- Start::slide -->
                        <li class="slide">
                            <a th:href="@{/private/company-miners}" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                                <span class="side-menu__label">Майнеры компании</span>
                            </a>
                        </li>
                        <!-- End::slide -->

                        <!-- Start::slide -->
                        <li class="slide">
                            <a th:href="@{/private/profitability}" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>
                                <span class="side-menu__label">Калькулятор доходности</span>
                            </a>
                        </li>
                        <!-- End::slide -->

                        <!-- Start::slide__category -->
                        <li class="slide__category" sec:authorize="hasRole('ADMIN')"><span class="category-name">Администрирование</span></li>
                        <!-- End::slide__category -->

                        <!-- Start::slide -->
                        <li class="slide" sec:authorize="hasRole('ADMIN')">
                            <a th:href="@{/private/users}" class="side-menu__item">
                                <svg xmlns="http://www.w3.org/2000/svg" class="side-menu__icon" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-3.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-3.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                                <span class="side-menu__label">Пользователи</span>
                            </a>
                        </li>
                        <!-- End::slide -->
                    </ul>
                </nav>
                <!-- End::nav -->
            </div>
            <!-- End::main-sidebar -->
        </aside>
        <!-- End::app-sidebar -->

        <!-- Start::app-content -->
        <div class="main-content app-content">
            <div class="container-fluid">
                <!-- Page Header -->
                <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
                    <div class="my-auto">
                        <h5 class="page-title fs-21 mb-1">Приватная панель</h5>
                        <nav>
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item"><a th:href="@{/}">Главная</a></li>
                                <li class="breadcrumb-item active" aria-current="page">Панель управления</li>
                            </ol>
                        </nav>
                    </div>
                </div>
                <!-- Page Header Close -->

                <!-- Start::row-1 -->
                <div class="row">
                    <!-- Сообщения (только для администраторов) -->
                    <div class="col-xl-4 col-lg-6 col-md-6" sec:authorize="hasRole('ADMIN')">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-md bg-primary-transparent rounded-circle me-3">
                                        <i class="fe fe-message-circle fs-20"></i>
                                    </div>
                                    <div class="flex-fill">
                                        <h6 class="mb-1 fw-semibold">Сообщения</h6>
                                        <p class="mb-0 text-muted fs-12">Просмотр и управление сообщениями из WhatsApp групп</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a th:href="@{/private/messages}" class="btn btn-primary btn-sm">Перейти к сообщениям <i class="fe fe-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Таблица товаров (только для администраторов) -->
                    <div class="col-xl-4 col-lg-6 col-md-6" sec:authorize="hasRole('ADMIN')">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-md bg-success-transparent rounded-circle me-3">
                                        <i class="fe fe-grid fs-20"></i>
                                    </div>
                                    <div class="flex-fill">
                                        <h6 class="mb-1 fw-semibold">Таблица товаров</h6>
                                        <p class="mb-0 text-muted fs-12">Просмотр всех товаров в табличном виде с подробной информацией</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a th:href="@{/private/products/table}" class="btn btn-success btn-sm">Перейти к таблице <i class="fe fe-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <!-- Предложения (для администраторов и менеджеров) -->
                    <div class="col-xl-4 col-lg-6 col-md-6" sec:authorize="hasAnyRole('ADMIN', 'MANAGER')">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-md bg-purple-transparent rounded-circle me-3">
                                        <i class="fe fe-shopping-bag fs-20"></i>
                                    </div>
                                    <div class="flex-fill">
                                        <h6 class="mb-1 fw-semibold">Предложения</h6>
                                        <p class="mb-0 text-muted fs-12">Просмотр всех предложений от продавцов, отсортированных от последнего</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a th:href="@{/private/offers}" class="btn btn-purple btn-sm">Перейти к предложениям <i class="fe fe-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
            
            <!-- Заявки -->
                    <div class="col-xl-4 col-lg-6 col-md-6">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-md bg-warning-transparent rounded-circle me-3">
                                        <i class="fe fe-clipboard fs-20"></i>
                                    </div>
                                    <div class="flex-fill">
                                        <h6 class="mb-1 fw-semibold">Заявки</h6>
                                        <p class="mb-0 text-muted fs-12">Просмотр и управление заявками от пользователей</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a th:href="@{/private/requests}" class="btn btn-warning btn-sm">Перейти к заявкам <i class="fe fe-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Калькулятор доходности -->
                    <div class="col-xl-4 col-lg-6 col-md-6">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-md bg-info-transparent rounded-circle me-3">
                                        <i class="fe fe-calculator fs-20"></i>
                                    </div>
                                    <div class="flex-fill">
                                        <h6 class="mb-1 fw-semibold">Калькулятор доходности</h6>
                                        <p class="mb-0 text-muted fs-12">Расчет доходности ASIC майнеров с учетом всех параметров</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a th:href="@{/private/profitability}" class="btn btn-info btn-sm">Перейти к калькулятору <i class="fe fe-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Детали майнеров -->
                    <div class="col-xl-4 col-lg-6 col-md-6">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-md bg-danger-transparent rounded-circle me-3">
                                        <i class="fe fe-cpu fs-20"></i>
                                    </div>
                                    <div class="flex-fill">
                                        <h6 class="mb-1 fw-semibold">Детали майнеров</h6>
                                        <p class="mb-0 text-muted fs-12">Просмотр всех записей MinerDetail в табличном виде</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a th:href="@{/private/miner-details}" class="btn btn-danger btn-sm">Перейти к таблице <i class="fe fe-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Майнеры компании -->
                    <div class="col-xl-4 col-lg-6 col-md-6">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-md bg-teal-transparent rounded-circle me-3">
                                        <i class="fe fe-server fs-20"></i>
                                    </div>
                                    <div class="flex-fill">
                                        <h6 class="mb-1 fw-semibold">Майнеры компании</h6>
                                        <p class="mb-0 text-muted fs-12">Управление майнерами компании: создание, редактирование, управление ценами</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a th:href="@{/private/company-miners}" class="btn btn-teal btn-sm">Перейти к майнерам <i class="fe fe-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Управление пользователями (только для администраторов) -->
                    <div class="col-xl-4 col-lg-6 col-md-6" sec:authorize="hasRole('ADMIN')">
                        <div class="card custom-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-md bg-secondary-transparent rounded-circle me-3">
                                        <i class="fe fe-users fs-20"></i>
                                    </div>
                                    <div class="flex-fill">
                                        <h6 class="mb-1 fw-semibold">Пользователи</h6>
                                        <p class="mb-0 text-muted fs-12">Управление пользователями системы: создание, редактирование, назначение ролей</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a th:href="@{/private/users}" class="btn btn-secondary btn-sm">Управление пользователями <i class="fe fe-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- row closed -->
            </div>
        </div>
        <!-- End::app-content -->

        <!-- Footer Start -->
        <footer class="footer mt-auto py-3 bg-white text-center">
            <div class="container">
                <span class="text-muted">© 2025 <a href="javascript:void(0);" class="text-dark fw-semibold">MinerHive</a>. Все права защищены.</span>
            </div>
        </footer>
        <!-- Footer End -->
    </div>

    <!-- Scroll To Top -->
    <div class="scrollToTop">
        <span class="arrow"><i class="las la-angle-double-up"></i></span>
    </div>
    <div id="responsive-overlay"></div>
    <!-- Scroll To Top -->

    <!-- Popper JS -->
    <script th:src="@{/bootstrap-theme/assets/libs/@popperjs/core/umd/popper.min.js}" src="../assets/libs/@popperjs/core/umd/popper.min.js"></script>

    <!-- Bootstrap JS -->
    <script th:src="@{/bootstrap-theme/assets/libs/bootstrap/js/bootstrap.bundle.min.js}" src="../assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Node Waves JS-->
    <script th:src="@{/bootstrap-theme/assets/libs/node-waves/waves.min.js}" src="../assets/libs/node-waves/waves.min.js"></script>

    <!-- Sticky JS -->
    <script th:src="@{/bootstrap-theme/assets/js/sticky.js}" src="../assets/js/sticky.js"></script>

    <!-- Simplebar JS -->
    <script th:src="@{/bootstrap-theme/assets/libs/simplebar/simplebar.min.js}" src="../assets/libs/simplebar/simplebar.min.js"></script>
    <script th:src="@{/bootstrap-theme/assets/js/simplebar.js}" src="../assets/js/simplebar.js"></script>

    <!-- Color Picker JS -->
    <script th:src="@{/bootstrap-theme/assets/libs/@simonwep/pickr/pickr.es5.min.js}" src="../assets/libs/@simonwep/pickr/pickr.es5.min.js"></script>
    
    <!-- Defaultmenu JS - loaded after elements are guaranteed to exist -->
    <script>
        // Ensure elements exist before loading defaultmenu.min.js
        if (typeof window.ensureElements === 'function') {
            window.ensureElements();
        }
    </script>
    <script th:src="@{/bootstrap-theme/assets/js/defaultmenu.min.js}" src="../assets/js/defaultmenu.min.js"></script>

    <!-- Custom-Switcher JS - loaded after elements are guaranteed to exist -->
    <script>
        // Ensure elements exist before loading custom-switcher.min.js
        if (typeof window.ensureElements === 'function') {
            window.ensureElements();
        }
    </script>
    <script th:src="@{/bootstrap-theme/assets/js/custom-switcher.min.js}" src="../assets/js/custom-switcher.min.js"></script>

    <!-- Custom JS - loaded after elements are guaranteed to exist -->
    <script>
        // Ensure elements exist before loading custom.js
        if (typeof window.ensureElements === 'function') {
            window.ensureElements();
        }
    </script>
    <script th:src="@{/bootstrap-theme/assets/js/custom.js}" src="../assets/js/custom.js"></script>
    
    <!-- Main Theme Js - Loaded at the end to ensure DOM elements are ready -->
    <script th:src="@{/bootstrap-theme/assets/js/main.js}" src="../assets/js/main.js"></script>
    
    <!-- Protection script to ensure all elements exist and prevent errors -->
    <script>
        // Ensure all critical elements exist after scripts load
        (function() {
            function finalCheckAndFix() {
                // Ensure horizontal-menu exists
                let horizontalMenu = document.querySelector('.horizontal-menu');
                if (!horizontalMenu || !horizontalMenu.querySelector('ul')) {
                    let headerCenter = document.querySelector('.main-header-center');
                    if (!headerCenter) {
                        const headerContentLeft = document.querySelector('.header-content-left');
                        if (headerContentLeft) {
                            headerCenter = document.createElement('div');
                            headerCenter.className = 'main-header-center d-none d-lg-block';
                            headerCenter.style.display = 'none';
                            const headerElement = headerContentLeft.querySelector('.header-element') || headerContentLeft;
                            headerElement.appendChild(headerCenter);
                        }
                    }
                    if (headerCenter) {
                        if (!horizontalMenu) {
                            horizontalMenu = document.createElement('nav');
                            horizontalMenu.className = 'horizontal-menu';
                            horizontalMenu.style.display = 'none';
                            headerCenter.appendChild(horizontalMenu);
                        }
                        if (!horizontalMenu.querySelector('ul')) {
                            horizontalMenu.innerHTML = '<ul class="horizontal-list"></ul>';
                        }
                    }
                }
                
                // Ensure switcher elements exist
                const switcherIcon = document.querySelector('.switcher-icon, [data-bs-toggle="offcanvas"][data-bs-target="#switcher-canvas"]');
                if (!switcherIcon && document.querySelector('#switcher-canvas')) {
                    // Switcher canvas exists, so icon should exist too - create placeholder if needed
                    const headerContentRight = document.querySelector('.header-content-right');
                    if (headerContentRight) {
                        const switcherContainer = headerContentRight.querySelector('.switcher-icon') || headerContentRight.querySelector('[data-bs-target="#switcher-canvas"]');
                        if (!switcherContainer) {
                            const switcherLink = document.createElement('a');
                            switcherLink.href = 'javascript:void(0);';
                            switcherLink.className = 'header-link switcher-icon';
                            switcherLink.setAttribute('data-bs-toggle', 'offcanvas');
                            switcherLink.setAttribute('data-bs-target', '#switcher-canvas');
                            switcherLink.style.display = 'none';
                            const headerElement = headerContentRight.querySelector('.header-element');
                            if (headerElement) {
                                headerElement.appendChild(switcherLink);
                            }
                        }
                    }
                }
            }
            
            // Run after page loads
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', finalCheckAndFix);
            } else {
                finalCheckAndFix();
            }
            
            setTimeout(finalCheckAndFix, 100);
            setTimeout(finalCheckAndFix, 500);
        })();
    </script>
    
    <!-- Cleanup script to remove leftover modal backdrops and fix overlay issues -->
    <script>
        (function() {
            // Function to clean up modal backdrops and restore body state
            function cleanupModals() {
                try {
                    // Remove all modal backdrops (both modal and offcanvas)
                    const backdrops = document.querySelectorAll('.modal-backdrop, .offcanvas-backdrop');
                    backdrops.forEach(backdrop => {
                        try {
                            backdrop.remove();
                        } catch (e) {
                            console.warn('Error removing backdrop:', e);
                        }
                    });
                    
                    // Remove modal-open class and restore body styles
                    if (document.body) {
                        document.body.classList.remove('modal-open');
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                    }
                    
                    // Close any open modals
                    const openModals = document.querySelectorAll('.modal.show');
                    openModals.forEach(modal => {
                        try {
                            if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
                                const bsModal = bootstrap.Modal.getInstance(modal);
                                if (bsModal) {
                                    bsModal.hide();
                                } else {
                                    modal.classList.remove('show');
                                    modal.style.display = 'none';
                                    modal.setAttribute('aria-hidden', 'true');
                                    modal.removeAttribute('aria-modal');
                                }
                            } else {
                                modal.classList.remove('show');
                                modal.style.display = 'none';
                                modal.setAttribute('aria-hidden', 'true');
                                modal.removeAttribute('aria-modal');
                            }
                        } catch (e) {
                            console.warn('Error closing modal:', e);
                        }
                    });
                    
                    // Close any open offcanvas elements
                    const openOffcanvas = document.querySelectorAll('.offcanvas.show');
                    openOffcanvas.forEach(offcanvas => {
                        try {
                            if (typeof bootstrap !== 'undefined' && bootstrap.Offcanvas) {
                                const bsOffcanvas = bootstrap.Offcanvas.getInstance(offcanvas);
                                if (bsOffcanvas) {
                                    bsOffcanvas.hide();
                                } else {
                                    offcanvas.classList.remove('show');
                                    offcanvas.classList.remove('showing');
                                    offcanvas.setAttribute('aria-hidden', 'true');
                                    offcanvas.removeAttribute('aria-modal');
                                }
                            } else {
                                offcanvas.classList.remove('show');
                                offcanvas.classList.remove('showing');
                                offcanvas.setAttribute('aria-hidden', 'true');
                                offcanvas.removeAttribute('aria-modal');
                            }
                        } catch (e) {
                            console.warn('Error closing offcanvas:', e);
                        }
                    });
                    
                    // Remove offcanvas backdrops specifically
                    const offcanvasBackdrops = document.querySelectorAll('.offcanvas-backdrop');
                    offcanvasBackdrops.forEach(backdrop => {
                        try {
                            backdrop.remove();
                        } catch (e) {
                            console.warn('Error removing offcanvas backdrop:', e);
                        }
                    });
                } catch (e) {
                    console.error('Error in cleanupModals:', e);
                }
            }
            
            // Prevent offcanvas from opening automatically on page load
            function preventAutoOpenOffcanvas() {
                try {
                    // Ensure offcanvas elements are closed and have proper attributes
                    const offcanvasElements = document.querySelectorAll('.offcanvas');
                    offcanvasElements.forEach(offcanvas => {
                        offcanvas.classList.remove('show', 'showing');
                        offcanvas.setAttribute('aria-hidden', 'true');
                        offcanvas.removeAttribute('aria-modal');
                        offcanvas.style.visibility = 'hidden';
                    });
                } catch (e) {
                    console.warn('Error preventing auto-open offcanvas:', e);
                }
            }
            
            // Run prevention immediately
            preventAutoOpenOffcanvas();
            
            // Run cleanup immediately
            cleanupModals();
            
            // Run cleanup after all scripts have loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    preventAutoOpenOffcanvas();
                    cleanupModals();
                });
            } else {
                // DOM already loaded, run immediately and after delays
                preventAutoOpenOffcanvas();
                cleanupModals();
                setTimeout(function() {
                    preventAutoOpenOffcanvas();
                    cleanupModals();
                }, 100);
                setTimeout(function() {
                    preventAutoOpenOffcanvas();
                    cleanupModals();
                }, 500);
                setTimeout(function() {
                    preventAutoOpenOffcanvas();
                    cleanupModals();
                }, 1000);
            }
            
            // Also clean up on window load
            window.addEventListener('load', function() {
                preventAutoOpenOffcanvas();
                cleanupModals();
                // Additional cleanup after page fully loads
                setTimeout(function() {
                    preventAutoOpenOffcanvas();
                    cleanupModals();
                }, 100);
            });
            
            // Clean up if modal events are triggered incorrectly
            if (typeof bootstrap !== 'undefined') {
                if (bootstrap.Modal) {
                    document.addEventListener('hidden.bs.modal', function(e) {
                        // Ensure cleanup after modal is hidden
                        setTimeout(cleanupModals, 100);
                    });
                    
                    document.addEventListener('show.bs.modal', function(e) {
                        // Clean up any existing backdrops before showing new modal
                        cleanupModals();
                    });
                }
                
                // Also handle offcanvas events
                if (bootstrap.Offcanvas) {
                    document.addEventListener('hidden.bs.offcanvas', function(e) {
                        // Ensure cleanup after offcanvas is hidden
                        setTimeout(cleanupModals, 100);
                    });
                    
                    document.addEventListener('show.bs.offcanvas', function(e) {
                        // Clean up any existing backdrops before showing new offcanvas
                        cleanupModals();
                    });
                }
            }
        })();
    </script>
</body>
</html>

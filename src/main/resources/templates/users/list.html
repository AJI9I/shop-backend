<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ru" dir="ltr" data-nav-layout="vertical" data-theme-mode="light" data-header-styles="light" data-menu-styles="light" data-toggled="close">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title th:text="${pageTitle}">Управление пользователями - MinerHive</title>
    <!-- Favicon -->
    <th:block th:replace="~{fragments/favicon :: favicon-tags}"></th:block>
    <link id="style" th:href="@{/bootstrap-theme/assets/libs/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/bootstrap-theme/assets/css/styles.min.css}" rel="stylesheet">
    <link th:href="@{/bootstrap-theme/assets/css/icons.css}" rel="stylesheet">
    <script th:inline="javascript">
        (function() {
            function ensureElements() {
                if (!document.querySelector('.horizontal-menu')) {
                    let headerCenter = document.querySelector('.main-header-center');
                    if (!headerCenter && document.querySelector('.header-content-left')) {
                        headerCenter = document.createElement('div');
                        headerCenter.className = 'main-header-center d-none d-lg-block';
                        headerCenter.style.display = 'none';
                        document.querySelector('.header-content-left').appendChild(headerCenter);
                    }
                    if (headerCenter) {
                        const horizontalMenu = document.createElement('nav');
                        horizontalMenu.className = 'horizontal-menu';
                        horizontalMenu.style.display = 'none';
                        headerCenter.appendChild(horizontalMenu);
                    }
                }
                if (!document.getElementById('loader')) {
                    const loader = document.createElement('div');
                    loader.id = 'loader';
                    loader.style.display = 'none';
                    if (document.body) document.body.insertBefore(loader, document.body.firstChild);
                }
                if (!document.getElementById('switcher-canvas')) {
                    const switcher = document.createElement('div');
                    switcher.className = 'offcanvas offcanvas-end';
                    switcher.id = 'switcher-canvas';
                    switcher.setAttribute('tabindex', '-1');
                    switcher.style.display = 'none';
                    if (document.body) document.body.appendChild(switcher);
                }
                if (!document.getElementById('header-sidebar')) {
                    const sidebar = document.createElement('div');
                    sidebar.className = 'offcanvas offcanvas-end';
                    sidebar.id = 'header-sidebar';
                    sidebar.setAttribute('tabindex', '-1');
                    sidebar.style.display = 'none';
                    if (document.body) document.body.appendChild(sidebar);
                }
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', ensureElements);
            } else {
                ensureElements();
            }
            if (document.body) ensureElements();
        })();
    </script>
    
    <!-- Стили для восстановления прокрутки страницы -->
    <style>
        /* Восстановление прокрутки страницы */
        html, body {
            overflow-x: hidden !important;
            overflow-y: auto !important;
        }
    </style>
</head>
<body>
    <div id="loader" style="display: none;"><div class="spinner-border text-primary"></div></div>
    <div class="page">
        <header class="app-header">
            <div class="main-header-container container-fluid">
                <div class="header-content-left">
                    <div class="header-element">
                        <div class="horizontal-logo">
                            <a th:href="@{/}" class="header-logo">
                                <img th:src="@{/bootstrap-theme/assets/images/brand-logos/desktop-logo.png}" alt="logo" class="desktop-logo">
                            </a>
                        </div>
                    </div>
                    <div class="header-element">
                        <a class="sidemenu-toggle header-link" data-bs-toggle="sidebar"><i class="header-icon fe fe-align-left"></i></a>
                        <div class="main-header-center d-none d-lg-block" style="display: none !important;"><nav class="horizontal-menu"></nav></div>
                    </div>
                </div>
                <div class="header-content-right">
                    <div class="header-element headerProfile-dropdown">
                        <a href="javascript:void(0);" class="header-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fe fe-user fs-20"></i></a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" th:href="@{/}">Главная</a></li>
                            <li><a class="dropdown-item" th:href="@{/logout}">Выход</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>
        <aside class="app-sidebar sticky" id="sidebar">
            <div class="main-sidebar-header">
                <a th:href="@{/}" class="header-logo">
                    <img th:src="@{/bootstrap-theme/assets/images/brand-logos/desktop-logo.png}" alt="logo" class="desktop-logo">
                </a>
            </div>
            <div class="main-sidebar">
                <nav class="main-menu-container nav nav-pills flex-column">
                    <ul class="main-menu">
                        <li class="slide"><a th:href="@{/private}" class="side-menu__item">Панель управления</a></li>
                        <li class="slide__category"><span>Управление</span></li>
                        <li class="slide" sec:authorize="hasRole('ADMIN')"><a th:href="@{/private/users}" class="side-menu__item active">Пользователи</a></li>
                    </ul>
                </nav>
            </div>
        </aside>
        <div class="main-content app-content">
            <div class="container-fluid">
                <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
                    <div class="my-auto">
                        <h5 class="page-title fs-21 mb-1">Управление пользователями</h5>
                        <nav><ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item"><a th:href="@{/}">Главная</a></li>
                            <li class="breadcrumb-item"><a th:href="@{/private}">Панель управления</a></li>
                            <li class="breadcrumb-item active">Пользователи</li>
                        </ol></nav>
                    </div>
                    <div>
                        <a th:href="@{/private/users/new}" class="btn btn-primary"><i class="fe fe-plus me-2"></i>Создать пользователя</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-12">
                        <div class="card custom-card">
                            <div class="card-header">
                                <div class="card-title">Список пользователей</div>
                            </div>
                            <div class="card-body">
                                <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                                    <span th:text="${success}"></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                                <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                                    <span th:text="${error}"></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover text-nowrap">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Имя пользователя</th>
                                                <th>Роли</th>
                                                <th>Активен</th>
                                                <th>Действия</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr th:each="user : ${users}">
                                                <td th:text="${user.id}"></td>
                                                <td th:text="${user.username}"></td>
                                                <td>
                                                    <span th:each="role : ${user.roles}" class="badge bg-primary me-1" th:text="${role}"></span>
                                                </td>
                                                <td>
                                                    <span th:if="${user.enabled}" class="badge bg-success">Да</span>
                                                    <span th:unless="${user.enabled}" class="badge bg-danger">Нет</span>
                                                </td>
                                                <td>
                                                    <a th:href="@{/private/users/{id}/edit(id=${user.id})}" class="btn btn-sm btn-primary me-1"><i class="fe fe-edit"></i></a>
                                                    <form th:action="@{/private/users/{id}/delete(id=${user.id})}" method="post" style="display: inline;" onsubmit="return confirm('Вы уверены, что хотите удалить этого пользователя?');">
                                                        <button type="submit" class="btn btn-sm btn-danger"><i class="fe fe-trash-2"></i></button>
                                                    </form>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer mt-auto py-3 bg-white text-center">
            <div class="container">
                <span class="text-muted">© 2025 <a href="javascript:void(0);" class="text-dark fw-semibold">MinerHive</a>. Все права защищены.</span>
            </div>
        </footer>
    </div>
    <script th:src="@{/bootstrap-theme/assets/libs/@popperjs/core/umd/popper.min.js}"></script>
    <script th:src="@{/bootstrap-theme/assets/libs/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/bootstrap-theme/assets/js/defaultmenu.min.js}"></script>
    <script th:src="@{/bootstrap-theme/assets/js/main.js}"></script>
</body>
</html>

